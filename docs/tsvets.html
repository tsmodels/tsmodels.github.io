<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 6 tsvets package | A Time Series Framework</title>
  <meta name="description" content="Documentation for the tsmodels framework" />
  <meta name="generator" content="bookdown 0.27 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 6 tsvets package | A Time Series Framework" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Documentation for the tsmodels framework" />
  <meta name="github-repo" content="tsmodels/tsmodels.github.io" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 6 tsvets package | A Time Series Framework" />
  
  <meta name="twitter:description" content="Documentation for the tsmodels framework" />
  

<meta name="author" content="The tsmodels team" />


<meta name="date" content="2022-10-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tsissm.html"/>
<link rel="next" href="tsforeign.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-177357579-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  
  function gtag(){dataLayer.push(arguments);}
  
  gtag('js', new Date());
  
  gtag('config', 'UA-177357579-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Time Series Forecasting Framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Installation</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="tsmethods.html"><a href="tsmethods.html"><i class="fa fa-check"></i><b>3</b> tsmethods package</a>
<ul>
<li class="chapter" data-level="3.1" data-path="tsmethods.html"><a href="tsmethods.html#introduction"><i class="fa fa-check"></i><b>3.1</b> Introduction</a></li>
<li class="chapter" data-level="3.2" data-path="tsmethods.html"><a href="tsmethods.html#tsmethods:simulation"><i class="fa fa-check"></i><b>3.2</b> Ensembling Forecast Distributions</a></li>
<li class="chapter" data-level="3.3" data-path="tsmethods.html"><a href="tsmethods.html#demonstration"><i class="fa fa-check"></i><b>3.3</b> Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tsets.html"><a href="tsets.html"><i class="fa fa-check"></i><b>4</b> tsets package</a>
<ul>
<li class="chapter" data-level="4.1" data-path="tsets.html"><a href="tsets.html#tsets:intro"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="tsets.html"><a href="tsets.html#tsets:taxonomy"><i class="fa fa-check"></i><b>4.2</b> Taxonomy of Models</a></li>
<li class="chapter" data-level="4.3" data-path="tsets.html"><a href="tsets.html#tsets:extensions"><i class="fa fa-check"></i><b>4.3</b> Extensions</a></li>
<li class="chapter" data-level="4.4" data-path="tsets.html"><a href="tsets.html#some-encompasing-alternatives"><i class="fa fa-check"></i><b>4.4</b> Some Encompasing Alternatives</a></li>
<li class="chapter" data-level="4.5" data-path="tsets.html"><a href="tsets.html#tsets:implementation"><i class="fa fa-check"></i><b>4.5</b> Package Implementation</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="tsets.html"><a href="tsets.html#tsets:implementation:constraints"><i class="fa fa-check"></i><b>4.5.1</b> Constraints</a></li>
<li class="chapter" data-level="4.5.2" data-path="tsets.html"><a href="tsets.html#tsets:implementation:initialization"><i class="fa fa-check"></i><b>4.5.2</b> Initialization</a></li>
<li class="chapter" data-level="4.5.3" data-path="tsets.html"><a href="tsets.html#tsets:implementation:transformations"><i class="fa fa-check"></i><b>4.5.3</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="tsets.html"><a href="tsets.html#tsets:demonstration"><i class="fa fa-check"></i><b>4.6</b> Demonstration</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:specification"><i class="fa fa-check"></i><b>4.6.1</b> The Specification Object</a></li>
<li class="chapter" data-level="4.6.2" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:estimation"><i class="fa fa-check"></i><b>4.6.2</b> Estimation</a></li>
<li class="chapter" data-level="4.6.3" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:prediction"><i class="fa fa-check"></i><b>4.6.3</b> Prediction</a></li>
<li class="chapter" data-level="4.6.4" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:filtering"><i class="fa fa-check"></i><b>4.6.4</b> Filtering</a></li>
<li class="chapter" data-level="4.6.5" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:simulation"><i class="fa fa-check"></i><b>4.6.5</b> Simulation</a></li>
<li class="chapter" data-level="4.6.6" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:profiling"><i class="fa fa-check"></i><b>4.6.6</b> Profiling</a></li>
<li class="chapter" data-level="4.6.7" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:backtesting"><i class="fa fa-check"></i><b>4.6.7</b> Backtesting</a></li>
<li class="chapter" data-level="4.6.8" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:benchmarking"><i class="fa fa-check"></i><b>4.6.8</b> Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tsissm.html"><a href="tsissm.html"><i class="fa fa-check"></i><b>5</b> tsissm package</a>
<ul>
<li class="chapter" data-level="5.1" data-path="tsissm.html"><a href="tsissm.html#tsissm:introduction"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="tsissm.html"><a href="tsissm.html#tsissm:initialization"><i class="fa fa-check"></i><b>5.2</b> State Initialization</a></li>
<li class="chapter" data-level="5.3" data-path="tsissm.html"><a href="tsissm.html#tsissm:likelihood"><i class="fa fa-check"></i><b>5.3</b> Log-Likelihood</a></li>
<li class="chapter" data-level="5.4" data-path="tsissm.html"><a href="tsissm.html#tsissm:implementation"><i class="fa fa-check"></i><b>5.4</b> Package Implementation</a></li>
<li class="chapter" data-level="5.5" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration"><i class="fa fa-check"></i><b>5.5</b> Demonstration</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:specification"><i class="fa fa-check"></i><b>5.5.1</b> Specification</a></li>
<li class="chapter" data-level="5.5.2" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:estimation"><i class="fa fa-check"></i><b>5.5.2</b> Estimation</a></li>
<li class="chapter" data-level="5.5.3" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:prediction"><i class="fa fa-check"></i><b>5.5.3</b> Prediction</a></li>
<li class="chapter" data-level="5.5.4" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:simulation"><i class="fa fa-check"></i><b>5.5.4</b> Simulation</a></li>
<li class="chapter" data-level="5.5.5" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:filtering"><i class="fa fa-check"></i><b>5.5.5</b> Filtering</a></li>
<li class="chapter" data-level="5.5.6" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:profiling"><i class="fa fa-check"></i><b>5.5.6</b> Profiling</a></li>
<li class="chapter" data-level="5.5.7" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:backtesting"><i class="fa fa-check"></i><b>5.5.7</b> Backtesting</a></li>
<li class="chapter" data-level="5.5.8" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:benchmarking"><i class="fa fa-check"></i><b>5.5.8</b> Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tsvets.html"><a href="tsvets.html"><i class="fa fa-check"></i><b>6</b> tsvets package</a>
<ul>
<li class="chapter" data-level="6.1" data-path="tsvets.html"><a href="tsvets.html#tsvets:introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="tsvets.html"><a href="tsvets.html#tsvets:regressors"><i class="fa fa-check"></i><b>6.2</b> Inclusion of External Regressors</a></li>
<li class="chapter" data-level="6.3" data-path="tsvets.html"><a href="tsvets.html#tsvets:likelihood"><i class="fa fa-check"></i><b>6.3</b> Log-Likelihood</a></li>
<li class="chapter" data-level="6.4" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence"><i class="fa fa-check"></i><b>6.4</b> Dependence Structure</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence:diagonal"><i class="fa fa-check"></i><b>6.4.1</b> Diagonal Covariance</a></li>
<li class="chapter" data-level="6.4.2" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence:equicorrelation"><i class="fa fa-check"></i><b>6.4.2</b> Equicorrelation</a></li>
<li class="chapter" data-level="6.4.3" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence:shrinkage"><i class="fa fa-check"></i><b>6.4.3</b> Shrinkage Covariance</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="tsvets.html"><a href="tsvets.html#tsvets:grouping"><i class="fa fa-check"></i><b>6.5</b> Grouping and Pooling</a></li>
<li class="chapter" data-level="6.6" data-path="tsvets.html"><a href="tsvets.html#tsvets:homogeneous"><i class="fa fa-check"></i><b>6.6</b> Homogeneous Coefficients and Aggregation</a></li>
<li class="chapter" data-level="6.7" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration"><i class="fa fa-check"></i><b>6.7</b> Demonstration</a>
<ul>
<li class="chapter" data-level="6.7.1" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:specification"><i class="fa fa-check"></i><b>6.7.1</b> Specification</a></li>
<li class="chapter" data-level="6.7.2" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example1"><i class="fa fa-check"></i><b>6.7.2</b> Example: Australian Retail Sales</a></li>
<li class="chapter" data-level="6.7.3" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example2"><i class="fa fa-check"></i><b>6.7.3</b> Example: Australian Retail Sales Grouped Dynamics</a></li>
<li class="chapter" data-level="6.7.4" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example3"><i class="fa fa-check"></i><b>6.7.4</b> Example: Australian Retail Sales Filtering</a></li>
<li class="chapter" data-level="6.7.5" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example4"><i class="fa fa-check"></i><b>6.7.5</b> Example: Australian Retail Sales Aggregation</a></li>
<li class="chapter" data-level="6.7.6" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example6"><i class="fa fa-check"></i><b>6.7.6</b> Example: Groupwise Pooling</a></li>
<li class="chapter" data-level="6.7.7" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example5"><i class="fa fa-check"></i><b>6.7.7</b> Example: Price Volume Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tsforeign.html"><a href="tsforeign.html"><i class="fa fa-check"></i><b>7</b> tsforeign package</a>
<ul>
<li class="chapter" data-level="7.1" data-path="tsforeign.html"><a href="tsforeign.html#tsforeign:introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="tsforeign.html"><a href="tsforeign.html#tsforeign:arima"><i class="fa fa-check"></i><b>7.2</b> ARIMA model</a></li>
<li class="chapter" data-level="7.3" data-path="tsforeign.html"><a href="tsforeign.html#tsforeign:bsts"><i class="fa fa-check"></i><b>7.3</b> bsts model</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tscausal.html"><a href="tscausal.html"><i class="fa fa-check"></i><b>8</b> tscausal package</a>
<ul>
<li class="chapter" data-level="8.1" data-path="tscausal.html"><a href="tscausal.html#tscausal:introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="tscausal.html"><a href="tscausal.html#tscausal:evalmeasures"><i class="fa fa-check"></i><b>8.2</b> Measures of Evaluation</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="tscausal.html"><a href="tscausal.html#tscausal:evalmeasures:pointwise"><i class="fa fa-check"></i><b>8.2.1</b> Pointwise Impact</a></li>
<li class="chapter" data-level="8.2.2" data-path="tscausal.html"><a href="tscausal.html#tscausal:evalmeasures:cumulative"><i class="fa fa-check"></i><b>8.2.2</b> Cumulative Impact</a></li>
<li class="chapter" data-level="8.2.3" data-path="tscausal.html"><a href="tscausal.html#tscausal:evalmeasures:meaneffect"><i class="fa fa-check"></i><b>8.2.3</b> Mean Effect</a></li>
<li class="chapter" data-level="8.2.4" data-path="tscausal.html"><a href="tscausal.html#tscausal:evalmeasures:relativeeffect"><i class="fa fa-check"></i><b>8.2.4</b> Mean Relative Effect</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="tscausal.html"><a href="tscausal.html#tscausal:significance"><i class="fa fa-check"></i><b>8.3</b> Evaluation of Significance</a></li>
<li class="chapter" data-level="8.4" data-path="tscausal.html"><a href="tscausal.html#tscausl:features"><i class="fa fa-check"></i><b>8.4</b> Package Features</a></li>
<li class="chapter" data-level="8.5" data-path="tscausal.html"><a href="tscausal.html#tscausl:demo"><i class="fa fa-check"></i><b>8.5</b> Package Demo</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="tsdistributions.html"><a href="tsdistributions.html"><i class="fa fa-check"></i><b>9</b> tsdistributions package</a>
<ul>
<li class="chapter" data-level="9.1" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:introduction"><i class="fa fa-check"></i><b>9.1</b> Introduction</a></li>
<li class="chapter" data-level="9.2" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions"><i class="fa fa-check"></i><b>9.2</b> Distributions</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions:norm"><i class="fa fa-check"></i><b>9.2.1</b> The Normal Distribution</a></li>
<li class="chapter" data-level="9.2.2" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions:std"><i class="fa fa-check"></i><b>9.2.2</b> The Student Distribution</a></li>
<li class="chapter" data-level="9.2.3" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions:ged"><i class="fa fa-check"></i><b>9.2.3</b> The Generalized Error Distribution</a></li>
<li class="chapter" data-level="9.2.4" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions:skewed"><i class="fa fa-check"></i><b>9.2.4</b> Skewed Distributions by Inverse Scale Factors</a></li>
<li class="chapter" data-level="9.2.5" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions:ghyp"><i class="fa fa-check"></i><b>9.2.5</b> The Generalized Hyperbolic Distribution and Sub-Families</a></li>
<li class="chapter" data-level="9.2.6" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions:ghst"><i class="fa fa-check"></i><b>9.2.6</b> The Generalized Hyperbolic Skew Student Distribution</a></li>
<li class="chapter" data-level="9.2.7" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:distributions:jsu"><i class="fa fa-check"></i><b>9.2.7</b> Johnson’s reparameterized SU Distribution</a></li>
</ul></li>
<li class="chapter" data-level="9.3" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:moments"><i class="fa fa-check"></i><b>9.3</b> A note on analytic higher moments</a></li>
<li class="chapter" data-level="9.4" data-path="tsdistributions.html"><a href="tsdistributions.html#tsdistributions:code"><i class="fa fa-check"></i><b>9.4</b> Implementation and Code Examples</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="tsgam.html"><a href="tsgam.html"><i class="fa fa-check"></i><b>10</b> tsgam package</a>
<ul>
<li class="chapter" data-level="10.1" data-path="tsgam.html"><a href="tsgam.html#tsgam:introduction"><i class="fa fa-check"></i><b>10.1</b> Introduction</a></li>
<li class="chapter" data-level="10.2" data-path="tsgam.html"><a href="tsgam.html#package-demo-electricity-load"><i class="fa fa-check"></i><b>10.2</b> Package Demo: Electricity Load</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="tsgam.html"><a href="tsgam.html#estimation"><i class="fa fa-check"></i><b>10.2.1</b> Estimation</a></li>
<li class="chapter" data-level="10.2.2" data-path="tsgam.html"><a href="tsgam.html#prediction"><i class="fa fa-check"></i><b>10.2.2</b> Prediction</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="other.html"><a href="other.html"><i class="fa fa-check"></i><b>11</b> Other packages</a></li>
<li class="chapter" data-level="12" data-path="experimental.html"><a href="experimental.html"><i class="fa fa-check"></i><b>12</b> Experimental Functionality</a>
<ul>
<li class="chapter" data-level="12.1" data-path="experimental.html"><a href="experimental.html#calibration-of-predictive-distributions"><i class="fa fa-check"></i><b>12.1</b> Calibration of Predictive Distributions</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="experimental.html"><a href="experimental.html#example-coming-soon"><i class="fa fa-check"></i><b>12.1.1</b> Example [Coming Soon]</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="experimental.html"><a href="experimental.html#beyond-box-cox-the-logit-normal-assumption-for-ratios"><i class="fa fa-check"></i><b>12.2</b> Beyond Box-Cox : The Logit-Normal Assumption for Ratios</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="news.html"><a href="news.html"><i class="fa fa-check"></i><b>13</b> News</a></li>
<li class="chapter" data-level="14" data-path="team.html"><a href="team.html"><i class="fa fa-check"></i><b>14</b> The tsmodels team</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Time Series Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tsvets" class="section level1 hasAnchor" number="6">
<h1><span class="header-section-number">Chapter 6</span> tsvets package<a href="tsvets.html#tsvets" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="tsvets:introduction" class="section level2 hasAnchor" number="6.1">
<h2><span class="header-section-number">6.1</span> Introduction<a href="tsvets.html#tsvets:introduction" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The vector exponential additive smoothing model (Vector ETS), introduced in <span class="citation">De Silva, Hyndman, and Snyder (<a href="#ref-desilva2010" role="doc-biblioref">2010</a>)</span>
naturally generalizes the univariate framework with a great deal of flexibility with
the dynamics of the unobserved components. The dynamics of the states can be common,
diagonal, grouped or fully parameterized, allowing for a rich set of patterns to be captured.
The <strong>tsvets</strong> package implements a more general and flexible version based on <span class="citation">Athanasopoulos and Silva (<a href="#ref-athanasopoulos2012" role="doc-biblioref">2012</a>)</span>,
with methods for estimation, inference, visualization, forecasting as well as aggregation.
As of version 0.4.3, missing values are allowed in the series. This works by zeroing our
the errors (i.e. taking the expectation) during the step update step for those series
with missingness at time t, whilst the covariance and likelihood is calculated on
the joint non-missingness data.</p>
<p>Let the vector of <span class="math inline">\(N\)</span> series at time <span class="math inline">\(t\)</span>, <span class="math inline">\(\bf{y}_t\)</span> be represented as a linear additive
combination of their unobserved level, slope and seasonal (with frequency <span class="math inline">\(m\)</span>)
components, <span class="math inline">\(\bf{l}_{t-1}\)</span>, <span class="math inline">\(\bf{b}_{t-1}\)</span> and <span class="math inline">\(\bf{s}_{t-m}\)</span> respectively.
Formally, the conditional mean of <span class="math inline">\(\bf{\hat y}_t\)</span> is given by:</p>
<p><span class="math display" id="eq:tsvets1">\[\begin{equation}
\bf{\hat y}_t = \bf{l}_{t - 1} + \Phi\bf{b}_{t - 1} + \bf{s}_{t - m},
\tag{6.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\Phi\)</span> is the <span class="math inline">\(N\times N\)</span> matrix of dampening parameters. In its reduced form, the model without seasonality is equivalent to a VARIMA(1,2,2) model,<a href="#fn15" class="footnote-ref" id="fnref15"><sup>15</sup></a> and <span class="math inline">\(\Phi\)</span> becomes the matrix of first order autoregressive coefficients.</p>
<p>The 1 step ahead forecast errors, <span class="math inline">\(\boldsymbol{\varepsilon}_t\)</span> follow a multivariate normal distribution:</p>
<p><span class="math display" id="eq:tsvets2">\[\begin{equation}
{\boldsymbol{\varepsilon} _t} = {\bf{y}_t} - {{\bf{\hat y}}_t},\quad {\boldsymbol{\varepsilon} _t} \sim {\bf{N}}\left( {{\bf{0}},\Sigma } \right).
\tag{6.2}
\end{equation}\]</span></p>
<p>The state equations have the following dynamics:</p>
<p><span class="math display" id="eq:tsvets3">\[\begin{equation}
\begin{array}{l}
{\bf{l}_t} = {\bf{l}_{t - 1}} + \Phi {\bf{b}_{t - 1}} + {\bf{A}}{\boldsymbol{\varepsilon}_t},\\
{\bf{b}_t} = \Phi {\bf{b}_{t - 1}} + {\bf{B}}{\boldsymbol{\varepsilon}_t},\\
{\bf{s}_t} = {\bf{s}_{t - m}} + {G_1}K{\boldsymbol{\varepsilon}_t},\\
{\bf{s}_{t - m}} = {\bf{s}_{t - i}} + {G_2}K{\boldsymbol{\varepsilon}_t},
\end{array}
\tag{6.3}
\end{equation}\]</span></p>
<p>where the matrices <span class="math inline">\(\mathbf{A}\)</span>, <span class="math inline">\(\mathbf{B}\)</span> and <span class="math inline">\(\mathbf{K}\)</span> represent the adjustment of the vector components to the errors, and can be diagonal, fully parameterized or scalar (common adjustment).</p>
<p>In vector innovations state space form, the system can be written as follows:</p>
<p><span class="math display" id="eq:tsvets4">\[\begin{equation}
\begin{array}{l}
{\bf{y}_t} = H{\bf{x}_{t - 1}} + {\boldsymbol{\varepsilon}_t},\\
{\bf{x}_t} = F{\bf{x}_{t - 1}} + GA{\boldsymbol{\varepsilon}_t}
\end{array}
\tag{6.4}
\end{equation}\]</span></p>
<p>where the matrices <span class="math inline">\(H\)</span>, <span class="math inline">\(F\)</span>, <span class="math inline">\(G\)</span> and <span class="math inline">\(A\)</span> are composed as follows:</p>
<p><span class="math display" id="eq:tsvets5">\[\begin{equation}
\mathop H\limits_{\left( {m + 2} \right)N \times N}  = \left[ {\begin{array}{*{20}{c}}
{{I_N}}\\
{{I_N}}\\
{{0_{N \times N}}}\\
\vdots \\
{{0_{N \times N}}}\\
{{I_N}}
\end{array}} \right],\quad \mathop A\limits_{\left( {m + 2} \right)N \times N}  = \left[ {\begin{array}{*{20}{c}}
{\bf{A}}\\
{\bf{B}}\\
{\bf{K}}\\
\vdots \\
\vdots \\
{\bf{K}}
\end{array}} \right],
\tag{6.5}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:tsvets6">\[\begin{equation}
\mathop F\limits_{\left( {m + 2} \right)N \times \left( {m + 2} \right)N}  = \left[ {\begin{array}{*{20}{c}}
{{I_N}}&amp;{{I_N}}&amp;{{0_{N \times mN}}}\\
{{0_{N \times N}}}&amp;{{\Phi _N}}&amp;{{0_{N \times mN}}}\\
{{0_{mN \times N}}}&amp;{{0_{mN \times N}}}&amp;{\tilde{F} \otimes {I_N}}
\end{array}} \right],\mathop {\tilde{F}}\limits_{m \times m}  = \left[ {\begin{array}{*{20}{c}}
0&amp;0&amp;0&amp; \cdots &amp;0&amp;1\\
1&amp;0&amp;0&amp; \cdots &amp;0&amp;0\\
0&amp;1&amp;0&amp; \cdots &amp;0&amp;0\\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
0&amp;0&amp;0&amp; \cdots &amp;1&amp;0
\end{array}} \right],
\tag{6.6}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:tsvets7">\[\begin{equation}
\mathop G\limits_{\left( {m + 2} \right)N \times \left( {m + 2} \right)N}  = \left[ {\begin{array}{*{20}{c}}
{{I_N}}&amp;{{0_{N \times N}}}&amp;{{0_{N \times mN}}}\\
{{0_{N \times N}}}&amp;{{I_N}}&amp;{{0_{N \times mN}}}\\
{{0_{mN \times N}}}&amp;{{0_{mN \times N}}}&amp;{\tilde{G} \otimes {I_N}}
\end{array}} \right],
\tag{6.7}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:tsvets0">\[\begin{equation}
\mathop {\tilde{G}}\limits_{m \times m}  = \left[ {\begin{array}{*{20}{c}}
{\frac{{m - 1}}{m}}&amp;0&amp; \cdots &amp;0&amp;0\\
0&amp;{ - \frac{1}{m}}&amp; \cdots &amp;0&amp;0\\
0&amp;0&amp;{ - \frac{1}{m}}&amp;0&amp;0\\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0&amp;0&amp;0&amp; \cdots &amp;{ - \frac{1}{m}}
\end{array}} \right],
\tag{6.8}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:tsvets8">\[\begin{equation}
\mathop {{\bf{x}_t}}\limits_{\left( {m + 2} \right)N \times N}  = \left[ {\begin{array}{*{20}{c}}
{{\bf{l}_t}}\\
{{\bf{b}_t}}\\
{{\bf{s}_t}}\\
\vdots \\
{{\bf{s}_{t - m + 2}}}\\
{{\bf{s}_{t - m + 1}}}
\end{array}} \right].
\tag{6.9}
\end{equation}\]</span></p>
<p>The values in the seasonal matrix <span class="math inline">\(\tilde{G}\)</span> represent normalization terms which
ensure that the seasonal component adds to zero throughout the updating process
without becoming contaminated by the level component.</p>
</div>
<div id="tsvets:regressors" class="section level2 hasAnchor" number="6.2">
<h2><span class="header-section-number">6.2</span> Inclusion of External Regressors<a href="tsvets.html#tsvets:regressors" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We augment the model with the ability to include external regressors (<span class="math inline">\(z_t\)</span>) such that:</p>
<p><span class="math display" id="eq:tsvets9">\[\begin{equation}
\begin{array}{l}
{\bf{y}_t} = H{\bf{x}_{t - 1}} + \mathbf{W}\bf{z}_t + {\boldsymbol{\varepsilon}_t},\\
{\bf{x}_t} = F{\bf{x}_{t - 1}} + GA{\boldsymbol{\varepsilon}_t},
\end{array}
\tag{6.10}
\end{equation}\]</span></p>
<p>where the <span class="math inline">\(W\)</span> is the matrix of coefficients which are time invariant. The <code>xreg_include</code> argument in the <code>vets_modelspec</code> function is a design matrix which allows one to define which coefficients should be set to zero, which should be estimated individually as well as which should be pooled (see the documentation for more details). The index on <span class="math inline">\(\bf{z}\)</span> is <span class="math inline">\(t\)</span> and not <span class="math inline">\(t-1\)</span> and it is left to the user to pre-lag any regressors passed to the function.</p>
</div>
<div id="tsvets:likelihood" class="section level2 hasAnchor" number="6.3">
<h2><span class="header-section-number">6.3</span> Log-Likelihood<a href="tsvets.html#tsvets:likelihood" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The log-likelihood (<span class="math inline">\(L\)</span>) of the model follows from the assumption that the innovations <span class="math inline">\(\boldsymbol{\varepsilon_t}\sim N\left(\bf{0}, \Sigma\right)\)</span>, leading to the following function:</p>
<p><span class="math display" id="eq:tsvets10">\[\begin{equation}
L\left(\boldsymbol{\theta}  \right) = \frac{T}{2}\left( {N\log \left( {2\pi } \right) + N\log \left| \Sigma  \right|} \right) - \frac{1}{2}\sum\limits_{t = 1}^T {\boldsymbol{\varepsilon_t}{\Sigma ^{ - 1}}\boldsymbol{\varepsilon_t}},
\tag{6.11}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\theta}\)</span> is the vector of parameters being optimized. We also concentrate out the parameters of the covariance matrix by using its ML estimator</p>
<p><span class="math display" id="eq:tsvets11">\[\begin{equation}
\hat \Sigma  = \frac{1}{T}\sum\limits_{t = 1}^T {{\boldsymbol{\varepsilon}_t}{{\boldsymbol{\varepsilon}&#39;}_t}}.
\tag{6.12}
\end{equation}\]</span></p>
<p>Therefore, the vector ETS log-likelihood is proportional to</p>
<p><span class="math display" id="eq:tsvets12">\[\begin{equation}
L\left(\boldsymbol{\theta}  \right) \propto \sum\limits_{t = 1}^T {{{\boldsymbol{\varepsilon}&#39;}_t}{{\hat \Sigma }^{ - 1}}{\boldsymbol{\varepsilon}_t}},
\tag{6.13}
\end{equation}\]</span></p>
<p>which requires looping through each <span class="math inline">\(t\)</span> to calculate the quadratic form which is expensive. Instead, we can make use of the following relationship, assuming positive-definite or positive-semi-definite <span class="math inline">\(\hat \Sigma\)</span>, <span class="math inline">\({\hat\Sigma ^{-1}} = Q\Lambda^{-1} Q&#39;\)</span>, where <span class="math inline">\(\Lambda\)</span> is the diagonal matrix of eigenvalues of <span class="math inline">\(\hat\Sigma\)</span>. We then have <span class="math inline">\({\varepsilon _t} = Q{\bf{u}_t}\)</span> where <span class="math inline">\(\bf{u}_t\)</span> are the projections onto the eigenvectors <span class="math inline">\(Q\)</span>. The negative of the log-likelihood can be represented as:</p>
<p><span class="math display" id="eq:tsvets13">\[\begin{equation}
L\left( \boldsymbol{\theta}  \right) = \frac{1}{2}T\left( {N\log 2\pi  - \log \left| {\hat \Sigma } \right|} \right) + \frac{1}{2}{{{\bf{1&#39;}}}_T}\left( {{{\left( {\varepsilon Q} \right)}^2}\frac{1}{\lambda }} \right),
\tag{6.14}
\end{equation}\]</span></p>
<p>where we have used the relation <span class="math inline">\(Q^{-1} = Q&#39;\)</span> due to <span class="math inline">\(\hat{\Sigma}\)</span> being symmetric (and thus <span class="math inline">\(Q\)</span> is orthogonal), and <span class="math inline">\(1 / \lambda\)</span> is a vector containing the reporicals of the eigenvalues.</p>
<p>Additionally, we constrain the <span class="math inline">\(N+1\)</span> largest eigenvalues (<span class="math inline">\(\lambda_s\)</span>) to be less than 1 to ensure invertibility of the system, such that</p>
<p><span class="math display" id="eq:tsvets15">\[\begin{equation}
{\lambda _s}\left( D \right) &lt; 1,D = F - GAH.
\tag{6.15}
\end{equation}\]</span></p>
<p>This is added as a soft barrier constraint. The diagonal elements of the level, slope, dampening and seasonal matrices are bounded between 0 and 1, while the off diagonal elements are allowed to vary between -1 and 1.<a href="#fn16" class="footnote-ref" id="fnref16"><sup>16</sup></a></p>
<p>Finally, the initial seed values for each of the states are approximated using the heuristic approach from the univariate ETS model as described in Section <a href="tsets.html#tsets:implementation:initialization">4.5.2</a>.</p>
</div>
<div id="tsvets:dependence" class="section level2 hasAnchor" number="6.4">
<h2><span class="header-section-number">6.4</span> Dependence Structure<a href="tsvets.html#tsvets:dependence" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>While Equation <a href="tsissm.html#eq:tsissm10">(5.10)</a> assumes a full covariance matrix, allowing contemporaneous associations among the residuals, we also offer 3 additional estimators for the dependence structure: diagonal covariance, equicorrelation and shrinkage covariance based on the estimator of <span class="citation">Ledoit and Wolf (<a href="#ref-ledoit2004well" role="doc-biblioref">2004</a>)</span>.</p>
<div id="tsvets:dependence:diagonal" class="section level3 hasAnchor" number="6.4.1">
<h3><span class="header-section-number">6.4.1</span> Diagonal Covariance<a href="tsvets.html#tsvets:dependence:diagonal" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The diagonal covariance matrix is the one used by <span class="citation">Athanasopoulos and Silva (<a href="#ref-athanasopoulos2012" role="doc-biblioref">2012</a>)</span>, and leads to the fastest estimation. In this case, the log-likelihood is greatly simplified and equal to</p>
<p><span class="math display" id="eq:tsvets16">\[\begin{equation}
\frac{T}{2}\left( {N\log \left( {2\pi } \right) + N\log \left| \Sigma  \right|} \right) - \frac{1}{2}\sum\limits_{t = 1}^T {\sum\limits_{i = 1}^N {\varepsilon _{it}^2/\sigma _i^2} }.
\tag{6.16}
\end{equation}\]</span></p>
</div>
<div id="tsvets:dependence:equicorrelation" class="section level3 hasAnchor" number="6.4.2">
<h3><span class="header-section-number">6.4.2</span> Equicorrelation<a href="tsvets.html#tsvets:dependence:equicorrelation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The equicorrelation covariance assumes that the correlation across all series is set to some common value <span class="math inline">\(\rho\)</span>. The correlation matrix <span class="math inline">\(\bf{R}\)</span> can be calculated as</p>
<p><span class="math display" id="eq:tsvets17">\[\begin{equation}
{\bf{R}} = \rho {\bf{11&#39;}} + \left( {1 - \rho } \right){\bf{I}},
\tag{6.17}
\end{equation}\]</span></p>
<p>which is guaranteed to be positive definite as long as <span class="math inline">\(-\frac{1}{{N - 1}}&lt;\rho&lt; 1\)</span>. The covariance is then equal to:</p>
<p><span class="math display" id="eq:tsvets18">\[\begin{equation}
{\Sigma} = {\bf{DRD&#39;}},
\tag{6.18}
\end{equation}\]</span></p>
<p>where <span class="math inline">\({\bf{D}} = diag\left( {{\hat \sigma _1},\dots,{\hat \sigma _n}} \right)\)</span>. Some of the advantages of assuming equicorrelation are discussed in <span class="citation">Clements, Scott, and Silvennoinen (<a href="#ref-clements2015benefits" role="doc-biblioref">2015</a>)</span>.</p>
</div>
<div id="tsvets:dependence:shrinkage" class="section level3 hasAnchor" number="6.4.3">
<h3><span class="header-section-number">6.4.3</span> Shrinkage Covariance<a href="tsvets.html#tsvets:dependence:shrinkage" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The shrinkage estimator of <span class="citation">Ledoit and Wolf (<a href="#ref-ledoit2004well" role="doc-biblioref">2004</a>)</span> follows from the observation that the eigenvalues of the estimated correlations tend to be more dispersed than the eigenvalues of the true data generating process. The shrinkage estimator of the covariance is based on a convex combination of the sample covariance <span class="math inline">\(\hat\Sigma\)</span> and a target covariance set to a multiple of the identity matrix. It is this combination weight <span class="math inline">\(\rho\)</span> which we estimate in the case of the shrinkage estimator</p>
<p><span class="math display" id="eq:tsvets18">\[\begin{equation}
{\Sigma} = \left( {1 - \rho } \right)\Sigma  + \frac{\rho }{n}tr\left( \Sigma  \right){\bf{I}}.
\tag{6.18}
\end{equation}\]</span></p>
</div>
</div>
<div id="tsvets:grouping" class="section level2 hasAnchor" number="6.5">
<h2><span class="header-section-number">6.5</span> Grouping and Pooling<a href="tsvets.html#tsvets:grouping" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <strong>tsvets</strong> package allows both global pooling of state component coefficients as well as group-wise pooling. For instance, if we had a large-dimensional system composed of series which have some common grouping structure (e.g. geographical, feature or statistical based), we could impose that these groups have common dynamics for some or all of the components. We provide an example of this in the demonstration section.</p>
</div>
<div id="tsvets:homogeneous" class="section level2 hasAnchor" number="6.6">
<h2><span class="header-section-number">6.6</span> Homogeneous Coefficients and Aggregation<a href="tsvets.html#tsvets:homogeneous" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When a model is estimated with all components pooled (i.e. common coefficients), then we can aggregate the model to obtain an aggregated representation in closed form, following Section 17.1.2 of <span class="citation">R. Hyndman et al. (<a href="#ref-hyndman2008" role="doc-biblioref">2008</a>)</span>. When this is not the case, we can still obtain an aggregated series from the estimation and prediction objects. This functionality is implemented via the <code>tsaggregate</code> method and we provide an example in the demonstration section.</p>
</div>
<div id="tsvets:demonstration" class="section level2 hasAnchor" number="6.7">
<h2><span class="header-section-number">6.7</span> Demonstration<a href="tsvets.html#tsvets:demonstration" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="tsvets:demonstration:specification" class="section level3 hasAnchor" number="6.7.1">
<h3><span class="header-section-number">6.7.1</span> Specification<a href="tsvets.html#tsvets:demonstration:specification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The specification function defines the entry point for setting up a vets model:</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="tsvets.html#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tsvets)))</span>
<span id="cb121-2"><a href="tsvets.html#cb121-2" aria-hidden="true" tabindex="-1"></a><span class="fu">args</span>(vets_modelspec)</span></code></pre></div>
<pre><code>## function (y, level = c(&quot;constant&quot;, &quot;diagonal&quot;, &quot;common&quot;, &quot;full&quot;, 
##     &quot;grouped&quot;), slope = c(&quot;none&quot;, &quot;constant&quot;, &quot;common&quot;, &quot;diagonal&quot;, 
##     &quot;full&quot;, &quot;grouped&quot;), damped = c(&quot;none&quot;, &quot;common&quot;, &quot;diagonal&quot;, 
##     &quot;full&quot;, &quot;grouped&quot;), seasonal = c(&quot;none&quot;, &quot;common&quot;, &quot;diagonal&quot;, 
##     &quot;full&quot;, &quot;grouped&quot;), group = NULL, xreg = NULL, xreg_include = NULL, 
##     frequency = 1, transformation = &quot;box-cox&quot;, lambda = NULL, 
##     lower = 0, upper = 1, dependence = c(&quot;diagonal&quot;, &quot;full&quot;, 
##         &quot;equicorrelation&quot;, &quot;shrinkage&quot;)) 
## NULL</code></pre>
<p>The specification has options for how the components of level, slope, dampening, seasonality are structured as well as the type of dependence to use. We also allow multicore processing since we require the initial state vectors to be calculated through calls to the <strong>tsets</strong> package, which can be done in parallel. The <code>lambda</code> argument can be set either to <code>NA</code>, in which case the multivariate version of the Box Cox transformation is used which targets a transformation to multivariate normality based on <span class="citation">Velilla (<a href="#ref-velilla1993note" role="doc-biblioref">1993</a>)</span> using the <code>powerTransform</code> function from the <a href="https://cran.r-project.org/web/packages/car/"><strong>car</strong></a> package of <span class="citation">Fox, Weisberg, and Price (<a href="#ref-R-car" role="doc-biblioref">2022</a>)</span>, a vector of length equal to the number of series of a single number to apply to all series, and <code>NULL</code> in which case no transformation is performed.</p>
<p>The next sections provide fully worked examples with methods showcasing the functionality of the package under different assumptions.</p>
</div>
<div id="tsvets:demonstration:example1" class="section level3 hasAnchor" number="6.7.2">
<h3><span class="header-section-number">6.7.2</span> Example: Australian Retail Sales<a href="tsvets.html#tsvets:demonstration:example1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We use a subset of the Australian retail dataset from package <strong>tsdatasets</strong> representing the monthly retail turnover in $Million AUD across different regions for the news vendor category, with common level, constant slope and diagonal seasonal and dependence structure.</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="tsvets.html#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tsvets)))</span>
<span id="cb123-2"><a href="tsvets.html#cb123-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsmethods))</span>
<span id="cb123-3"><a href="tsvets.html#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsaux))</span>
<span id="cb123-4"><a href="tsvets.html#cb123-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(xts))</span>
<span id="cb123-5"><a href="tsvets.html#cb123-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb123-6"><a href="tsvets.html#cb123-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(austretail[,<span class="fu">grepl</span>(<span class="st">&quot;NEWS&quot;</span>, <span class="fu">colnames</span>(austretail))]) </span>
<span id="cb123-7"><a href="tsvets.html#cb123-7" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">vets_modelspec</span>(y, <span class="at">level =</span> <span class="st">&quot;common&quot;</span>, <span class="at">slope =</span> <span class="st">&quot;constant&quot;</span>, <span class="at">damped =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb123-8"><a href="tsvets.html#cb123-8" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seasonal =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="at">lambda =</span> <span class="cn">NA</span>, <span class="at">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, </span>
<span id="cb123-9"><a href="tsvets.html#cb123-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb123-10"><a href="tsvets.html#cb123-10" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate</span>(spec, <span class="at">solver =</span> <span class="st">&quot;solnp&quot;</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>The joint estimation of the 8 series takes about 0.5980759 seconds. The summary object prints the full matrices for each component using the Matrix package of <span class="citation">Bates, Maechler, and Jagan (<a href="#ref-R-Matrix" role="doc-biblioref">2022</a>)</span>. The summary method also take an optional <code>weights</code> argument which is used to calculate the weighted Accuracy Criteria, and when this is <code>NULL</code>, an equal weight vector is used instead (and hence equivalent to the Mean Criteria).</p>
<p>Similar to other packages, there is a diagnostics method <code>tsdiagnose</code> which prints the eiganvalues of the <span class="math inline">\(D\)</span> matrix as well as the output from a multivariate Normality Test and Multivariate Outliers based on the <code>mvn</code> function of the <a href="https://cran.r-project.org/web/packages/MVN/"><strong>MVN</strong></a> package of <span class="citation">Korkmaz, Goksuluk, and Zararsiz (<a href="#ref-R-MVN" role="doc-biblioref">2021</a>)</span>.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="tsvets.html#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : constant 
## Seasonal : diagonal 
## Dependence : diagonal 
## No. Series : 8 
## No. TimePoints : 369 
## 
## Parameter Matrices
## 
## Level Matrix
## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]     
## [1,] 0.7237793         .         .         .         .         .         .
## [2,]         . 0.7237793         .         .         .         .         .
## [3,]         .         . 0.7237793         .         .         .         .
## [4,]         .         .         . 0.7237793         .         .         .
## [5,]         .         .         .         . 0.7237793         .         .
## [6,]         .         .         .         .         . 0.7237793         .
## [7,]         .         .         .         .         .         . 0.7237793
## [8,]         .         .         .         .         .         .         .
##      [,8]     
## [1,]         .
## [2,]         .
## [3,]         .
## [4,]         .
## [5,]         .
## [6,]         .
## [7,]         .
## [8,] 0.7237793
## 
## Slope Matrix
## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
## [1,]    0    .    .    .    .    .    .    .
## [2,]    .    0    .    .    .    .    .    .
## [3,]    .    .    0    .    .    .    .    .
## [4,]    .    .    .    0    .    .    .    .
## [5,]    .    .    .    .    0    .    .    .
## [6,]    .    .    .    .    .    0    .    .
## [7,]    .    .    .    .    .    .    0    .
## [8,]    .    .    .    .    .    .    .    0
## 
## Seasonal Matrix
## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]      [,2]         [,3]         [,4]         [,5]         [,6]        
## [1,] 0.2884931            .            .            .            .            .
## [2,]         . 2.396104e-09            .            .            .            .
## [3,]         .            . 3.553894e-09            .            .            .
## [4,]         .            .            . 6.317263e-09            .            .
## [5,]         .            .            .            . 4.995968e-09            .
## [6,]         .            .            .            .            . 6.078841e-09
## [7,]         .            .            .            .            .            .
## [8,]         .            .            .            .            .            .
##      [,7]      [,8]        
## [1,]         .            .
## [2,]         .            .
## [3,]         .            .
## [4,]         .            .
## [5,]         .            .
## [6,]         .            .
## [7,] 0.1520137            .
## [8,]         . 3.009261e-09
## 
## Correlation Matrix
## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##          ACF.NEWS NSW.NEWS NT.NEWS Q.NEWS SA.NEWS T.NEWS V.NEWS WA.NEWS
## ACF.NEWS        1        .       .      .       .      .      .       .
## NSW.NEWS        .        1       .      .       .      .      .       .
## NT.NEWS         .        .       1      .       .      .      .       .
## Q.NEWS          .        .       .      1       .      .      .       .
## SA.NEWS         .        .       .      .       1      .      .       .
## T.NEWS          .        .       .      .       .      1      .       .
## V.NEWS          .        .       .      .       .      .      1       .
## WA.NEWS         .        .       .      .       .      .      .       1
## 
## Information Criteria
##  AIC     BIC     AICc   
##  1536.99 2261.81 1547.42
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0613   0.0613
## MSLRE 0.0067   0.0067</code></pre>
<p>Additional methods are similar to what is available in other packages.</p>
<p>Coefficients:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="tsvets.html#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(mod)</span></code></pre></div>
<pre><code>##      Level[Common] Seasonal[ACF.NEWS] Seasonal[NSW.NEWS]  Seasonal[NT.NEWS] 
##       7.237793e-01       2.884931e-01       2.396104e-09       3.553894e-09 
##   Seasonal[Q.NEWS]  Seasonal[SA.NEWS]   Seasonal[T.NEWS]   Seasonal[V.NEWS] 
##       6.317263e-09       4.995968e-09       6.078841e-09       1.520137e-01 
##  Seasonal[WA.NEWS] 
##       3.009261e-09</code></pre>
<p>Loglikelihood and AIC:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="tsvets.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="fu">logLik</span>(mod)</span></code></pre></div>
<pre><code>## &#39;log Lik.&#39; 1294.991 (df=121)</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="tsvets.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="fu">AIC</span>(mod)</span></code></pre></div>
<pre><code>## [1] 1536.991</code></pre>
<p>Performance metrics with optional weights option:</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="tsvets.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsmetrics</span>(mod, <span class="at">weights =</span> <span class="fu">runif</span>(<span class="dv">8</span>))</span></code></pre></div>
<pre><code>##      N no_pars   LogLik      AIC     BIC     AICc       MAPE      MSLRE
## 1 2952     121 1294.991 1536.991 2261.81 1547.424 0.06131029 0.00673102
##         WAPE       WSLRE
## 1 0.06051585 0.006598354</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="tsvets.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tscor</span>(mod)</span></code></pre></div>
<pre><code>## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##          ACF.NEWS NSW.NEWS NT.NEWS Q.NEWS SA.NEWS T.NEWS V.NEWS WA.NEWS
## ACF.NEWS        1        .       .      .       .      .      .       .
## NSW.NEWS        .        1       .      .       .      .      .       .
## NT.NEWS         .        .       1      .       .      .      .       .
## Q.NEWS          .        .       .      1       .      .      .       .
## SA.NEWS         .        .       .      .       1      .      .       .
## T.NEWS          .        .       .      .       .      1      .       .
## V.NEWS          .        .       .      .       .      .      1       .
## WA.NEWS         .        .       .      .       .      .      .       1</code></pre>
<p>Correlation and covariance matrices:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="tsvets.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tscov</span>(mod)</span></code></pre></div>
<pre><code>## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##           ACF.NEWS    NSW.NEWS    NT.NEWS      Q.NEWS     SA.NEWS     T.NEWS
## ACF.NEWS 0.0089999           .          .           .           .          .
## NSW.NEWS         . 0.003625678          .           .           .          .
## NT.NEWS          .           . 0.03950474           .           .          .
## Q.NEWS           .           .          . 0.004023731           .          .
## SA.NEWS          .           .          .           . 0.006397141          .
## T.NEWS           .           .          .           .           . 0.03014232
## V.NEWS           .           .          .           .           .          .
## WA.NEWS          .           .          .           .           .          .
##               V.NEWS    WA.NEWS
## ACF.NEWS           .          .
## NSW.NEWS           .          .
## NT.NEWS            .          .
## Q.NEWS             .          .
## SA.NEWS            .          .
## T.NEWS             .          .
## V.NEWS   0.004275613          .
## WA.NEWS            . 0.02804386</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="tsvets.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tscor</span>(mod)</span></code></pre></div>
<pre><code>## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##          ACF.NEWS NSW.NEWS NT.NEWS Q.NEWS SA.NEWS T.NEWS V.NEWS WA.NEWS
## ACF.NEWS        1        .       .      .       .      .      .       .
## NSW.NEWS        .        1       .      .       .      .      .       .
## NT.NEWS         .        .       1      .       .      .      .       .
## Q.NEWS          .        .       .      1       .      .      .       .
## SA.NEWS         .        .       .      .       1      .      .       .
## T.NEWS          .        .       .      .       .      1      .       .
## V.NEWS          .        .       .      .       .      .      1       .
## WA.NEWS         .        .       .      .       .      .      .       1</code></pre>
<p>Note that, even though we impose a diagonal covariance matrix structure, we still return the full covariance matrix in <code>tscov</code>.</p>
<p>Fitted and residuals:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="tsvets.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">fitted</span>(mod)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            ACF.NEWS NSW.NEWS  NT.NEWS   Q.NEWS
## 1988-04-30 5.083160 73.64485 1.826273 32.42631
## 1988-05-31 5.678305 77.54145 1.992810 33.63348
## 1988-06-30 5.068541 74.72022 2.038204 34.26928
## 1988-07-31 4.932006 80.55169 2.504371 36.89154</code></pre>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="tsvets.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">residuals</span>(mod)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##               ACF.NEWS   NSW.NEWS      NT.NEWS     Q.NEWS
## 1988-04-30  0.01683990 -0.6448491 -0.026272664 -0.6263074
## 1988-05-31 -0.07830457  2.7585476  0.007190382  3.0665182
## 1988-06-30 -0.06854076  0.5797782  0.361795877  0.4307202
## 1988-07-31 -0.03200619 -6.3516878 -0.104371326  2.2084582</code></pre>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="tsvets.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">residuals</span>(mod, <span class="at">raw =</span> <span class="cn">TRUE</span>)[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##                ACF.NEWS     NSW.NEWS      NT.NEWS      Q.NEWS
## 1988-04-30  0.003307404 -0.008794762 -0.021775194 -0.01950376
## 1988-05-31 -0.013886100  0.034956958  0.005781138  0.08725470
## 1988-06-30 -0.013615046  0.007729372  0.281470559  0.01249037
## 1988-07-31 -0.006510636 -0.082134913 -0.078646140  0.05814016</code></pre>
<p>where argument <code>raw</code> denotes the non backtransformed residuals (if a Box Cox calculation was used).</p>
<p>States decomposition:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="tsvets.html#cb146-1" aria-hidden="true" tabindex="-1"></a>tsx <span class="ot">&lt;-</span> <span class="fu">tsdecompose</span>(mod)</span>
<span id="cb146-2"><a href="tsvets.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tsx<span class="sc">$</span>Level[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            Level[ACF.NEWS] Level[NSW.NEWS] Level[NT.NEWS] Level[Q.NEWS]
## 1988-04-30        1.691734        4.364045      0.9000652      3.546509
## 1988-05-31        1.681585        4.389578      0.9021136      3.610841
## 1988-06-30        1.671633        4.395405      1.1037003      3.621061
## 1988-07-31        1.666822        4.336189      1.0446420      3.664320</code></pre>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="tsvets.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tsx<span class="sc">$</span>Slope[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            Slope[ACF.NEWS] Slope[NSW.NEWS] Slope[NT.NEWS] Slope[Q.NEWS]
## 1988-04-30   -9.831044e-05    0.0002321412   -0.002135869   0.001179101
## 1988-05-31   -9.831044e-05    0.0002321412   -0.002135869   0.001179101
## 1988-06-30   -9.831044e-05    0.0002321412   -0.002135869   0.001179101
## 1988-07-31   -9.831044e-05    0.0002321412   -0.002135869   0.001179101</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="tsvets.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tsx<span class="sc">$</span>Seasonal[,<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            Seasonal[ACF.NEWS] Seasonal[NSW.NEWS] Seasonal[NT.NEWS]
## 1988-04-30        0.045016743       -0.013464562       -0.01673148
## 1988-05-31       -0.058434214       -0.076059727        0.01760856
## 1988-06-30       -0.075788732       -0.006737928        0.17613856
## 1988-07-31       -0.002813842        0.020157397        0.15300637
##            Seasonal[Q.NEWS]
## 1988-04-30     -0.032166030
## 1988-05-31     -0.077771015
## 1988-06-30     -0.014257399
## 1988-07-31      0.009366033</code></pre>
<p>Plot methods exist outputting the fitted values, the states and the residuals, with an argument for the series to output, with a maximum number per call of 10 series:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="tsvets.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-14-1.png" width="768" /></p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="tsvets.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">type =</span> <span class="st">&quot;states&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-14-2.png" width="768" /></p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="tsvets.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">type =</span> <span class="st">&quot;residuals&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-14-3.png" width="768" /></p>
<p>The <code>predict</code> function will output a list which includes data.table of each series’ prediction object and state decomposition:</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="tsvets.html#cb155-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">h =</span> <span class="dv">12</span>)</span>
<span id="cb155-2"><a href="tsvets.html#cb155-2" aria-hidden="true" tabindex="-1"></a>p<span class="sc">$</span>prediction_table</span></code></pre></div>
<pre><code>##      series                Level                Slope             Seasonal
##      &lt;char&gt;               &lt;list&gt;               &lt;list&gt;               &lt;list&gt;
## 1: ACF.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 2: NSW.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 3:  NT.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 4:   Q.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 5:  SA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 6:   T.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 7:   V.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 8:  WA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
##         X                Error            Predicted
##    &lt;list&gt;               &lt;list&gt;               &lt;list&gt;
## 1:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 2:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 3:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 4:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 5:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 6:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 7:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 8:        &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;</code></pre>
<p>The plot method on the predicted object can output 1 series at a time using the <code>series</code> argument:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="tsvets.html#cb157-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p, <span class="at">series =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-16-1.png" width="768" /></p>
<p>The simulation method also returns a list with a data.table object with each series’ simulation object and state decomposition. Additionally, there are optional arguments for the initial state to use (<code>init_states</code>) and parameter vector (<code>pars</code>).</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="tsvets.html#cb158-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">simulate</span>(mod, <span class="at">h =</span> <span class="dv">12</span><span class="sc">*</span><span class="dv">8</span>, <span class="at">nsim =</span> <span class="dv">100</span>, <span class="at">init_states =</span> mod<span class="sc">$</span>spec<span class="sc">$</span>vets_env<span class="sc">$</span>States[,<span class="dv">1</span>])</span>
<span id="cb158-2"><a href="tsvets.html#cb158-2" aria-hidden="true" tabindex="-1"></a>s<span class="sc">$</span>simulation_table</span></code></pre></div>
<pre><code>##      series                Level                Slope             Seasonal
##      &lt;char&gt;               &lt;list&gt;               &lt;list&gt;               &lt;list&gt;
## 1: ACF.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 2: NSW.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 3:  NT.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 4:   Q.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 5:  SA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 6:   T.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 7:   V.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 8:  WA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
##               Simulated
##                  &lt;list&gt;
## 1: &lt;tsmodel.predict[2]&gt;
## 2: &lt;tsmodel.predict[2]&gt;
## 3: &lt;tsmodel.predict[2]&gt;
## 4: &lt;tsmodel.predict[2]&gt;
## 5: &lt;tsmodel.predict[2]&gt;
## 6: &lt;tsmodel.predict[2]&gt;
## 7: &lt;tsmodel.predict[2]&gt;
## 8: &lt;tsmodel.predict[2]&gt;</code></pre>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="tsvets.html#cb160-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">1</span>),<span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb160-2"><a href="tsvets.html#cb160-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s<span class="sc">$</span>simulation_table[series <span class="sc">==</span> <span class="st">&quot;ACF.NEWS&quot;</span>]<span class="sc">$</span>Simulated[[<span class="dv">1</span>]], <span class="at">main =</span> <span class="st">&quot;Simulated Series&quot;</span>)</span>
<span id="cb160-3"><a href="tsvets.html#cb160-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s<span class="sc">$</span>simulation_table[series <span class="sc">==</span> <span class="st">&quot;ACF.NEWS&quot;</span>]<span class="sc">$</span>Level[[<span class="dv">1</span>]], <span class="at">main =</span> <span class="st">&quot;Simulated Level&quot;</span>)</span>
<span id="cb160-4"><a href="tsvets.html#cb160-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s<span class="sc">$</span>simulation_table[series <span class="sc">==</span> <span class="st">&quot;ACF.NEWS&quot;</span>]<span class="sc">$</span>Slope[[<span class="dv">1</span>]], <span class="at">main =</span> <span class="st">&quot;Simulated Slope&quot;</span>)</span>
<span id="cb160-5"><a href="tsvets.html#cb160-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s<span class="sc">$</span>simulation_table[series <span class="sc">==</span> <span class="st">&quot;ACF.NEWS&quot;</span>]<span class="sc">$</span>Seasonal[[<span class="dv">1</span>]], <span class="at">main =</span> <span class="st">&quot;Simulated Seasonal&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-17-1.png" width="768" /></p>
<p>The <code>tsbacktest</code> method has similar arguments to other backtest implementations in the <strong>tsmodels</strong> framework:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="tsvets.html#cb161-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(future))</span>
<span id="cb161-2"><a href="tsvets.html#cb161-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(<span class="fu">list</span>(</span>
<span id="cb161-3"><a href="tsvets.html#cb161-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tweak</span>(sequential),</span>
<span id="cb161-4"><a href="tsvets.html#cb161-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tweak</span>(multisession, <span class="at">workers =</span> <span class="dv">5</span>)</span>
<span id="cb161-5"><a href="tsvets.html#cb161-5" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb161-6"><a href="tsvets.html#cb161-6" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> <span class="fu">tsbacktest</span>(spec, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">solver =</span> <span class="st">&quot;nlminb&quot;</span>, <span class="at">trace =</span> <span class="cn">FALSE</span>, <span class="at">autodiff =</span> <span class="cn">TRUE</span>)</span>
<span id="cb161-7"><a href="tsvets.html#cb161-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(sequential)</span></code></pre></div>
<p>The returned object is a list of 2 data.tables with the predictions for each series by estimation date and horizon and the summary metrics table:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="tsvets.html#cb162-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(b<span class="sc">$</span>prediction)</span></code></pre></div>
<pre><code>##      series estimation_date horizon  size forecast_dates forecast actual
##      &lt;char&gt;          &lt;Date&gt;   &lt;int&gt; &lt;int&gt;         &lt;char&gt;    &lt;num&gt;  &lt;num&gt;
## 1: ACF.NEWS      2003-07-31       1   184     2003-08-31 11.22847   11.2
## 2: ACF.NEWS      2003-07-31       2   184     2003-09-30 10.64990   10.1
## 3: ACF.NEWS      2003-07-31       3   184     2003-10-31 10.57616    9.7
## 4: ACF.NEWS      2003-07-31       4   184     2003-11-30 11.29816    9.7
## 5: ACF.NEWS      2003-07-31       5   184     2003-12-31 15.65695   14.2
## 6: ACF.NEWS      2003-07-31       6   184     2004-01-31 10.19482    8.6</code></pre>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="tsvets.html#cb164-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(b<span class="sc">$</span>metrics)</span></code></pre></div>
<pre><code>##      series horizon       MAPE      MSLRE       BIAS     n
##      &lt;char&gt;   &lt;int&gt;      &lt;num&gt;      &lt;num&gt;      &lt;num&gt; &lt;int&gt;
## 1: ACF.NEWS       1 0.08299767 0.01147201 0.01607784   185
## 2: ACF.NEWS       2 0.09826851 0.01485794 0.02508737   184
## 3: ACF.NEWS       3 0.10889976 0.01775767 0.03540852   183
## 4: ACF.NEWS       4 0.11984134 0.02163159 0.04479359   182
## 5: ACF.NEWS       5 0.11957098 0.02159764 0.05274425   181
## 6: ACF.NEWS       6 0.12708012 0.02327741 0.06098494   180</code></pre>
</div>
<div id="tsvets:demonstration:example2" class="section level3 hasAnchor" number="6.7.3">
<h3><span class="header-section-number">6.7.3</span> Example: Australian Retail Sales Grouped Dynamics<a href="tsvets.html#tsvets:demonstration:example2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this example, we show how grouping works on 99 series, where grouping is by sector.</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="tsvets.html#cb166-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tsvets)))</span>
<span id="cb166-2"><a href="tsvets.html#cb166-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsmethods))</span>
<span id="cb166-3"><a href="tsvets.html#cb166-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsaux))</span>
<span id="cb166-4"><a href="tsvets.html#cb166-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(xts))</span>
<span id="cb166-5"><a href="tsvets.html#cb166-5" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(data.table))</span>
<span id="cb166-6"><a href="tsvets.html#cb166-6" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(future))</span>
<span id="cb166-7"><a href="tsvets.html#cb166-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(<span class="fu">list</span>(</span>
<span id="cb166-8"><a href="tsvets.html#cb166-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tweak</span>(sequential),</span>
<span id="cb166-9"><a href="tsvets.html#cb166-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">tweak</span>(multisession, <span class="at">workers =</span> <span class="dv">5</span>)</span>
<span id="cb166-10"><a href="tsvets.html#cb166-10" aria-hidden="true" tabindex="-1"></a>))</span>
<span id="cb166-11"><a href="tsvets.html#cb166-11" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb166-12"><a href="tsvets.html#cb166-12" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> austretail[<span class="st">&quot;2000/&quot;</span>]</span>
<span id="cb166-13"><a href="tsvets.html#cb166-13" aria-hidden="true" tabindex="-1"></a>include <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(y), <span class="cf">function</span>(i) <span class="fu">all</span>(<span class="sc">!</span><span class="fu">is.na</span>(y[,i])))</span>
<span id="cb166-14"><a href="tsvets.html#cb166-14" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y[,include]</span>
<span id="cb166-15"><a href="tsvets.html#cb166-15" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(y), <span class="cf">function</span>(i) <span class="fu">strsplit</span>(<span class="fu">colnames</span>(y[,i]), <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])</span>
<span id="cb166-16"><a href="tsvets.html#cb166-16" aria-hidden="true" tabindex="-1"></a>groups_index <span class="ot">&lt;-</span> <span class="fu">sort.int</span>(groups, <span class="at">index.return =</span> <span class="cn">TRUE</span>)</span>
<span id="cb166-17"><a href="tsvets.html#cb166-17" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> y[,groups_index<span class="sc">$</span>ix]</span>
<span id="cb166-18"><a href="tsvets.html#cb166-18" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> groups[groups_index<span class="sc">$</span>ix]</span>
<span id="cb166-19"><a href="tsvets.html#cb166-19" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">rle</span>(groups)<span class="sc">$</span>lengths</span>
<span id="cb166-20"><a href="tsvets.html#cb166-20" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(groups), <span class="cf">function</span>(i) <span class="fu">rep</span>(i, groups[i])))</span>
<span id="cb166-21"><a href="tsvets.html#cb166-21" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">vets_modelspec</span>(y[,<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>], <span class="at">level =</span> <span class="st">&quot;grouped&quot;</span>, <span class="at">slope =</span> <span class="st">&quot;grouped&quot;</span>, <span class="at">damped =</span> <span class="st">&quot;none&quot;</span>,</span>
<span id="cb166-22"><a href="tsvets.html#cb166-22" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> groups[<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>],  <span class="at">seasonal =</span> <span class="st">&quot;grouped&quot;</span>, <span class="at">lambda =</span> <span class="fl">0.5</span>, </span>
<span id="cb166-23"><a href="tsvets.html#cb166-23" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb166-24"><a href="tsvets.html#cb166-24" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate</span>(spec, <span class="at">solver =</span> <span class="st">&quot;nlminb&quot;</span>)</span>
<span id="cb166-25"><a href="tsvets.html#cb166-25" aria-hidden="true" tabindex="-1"></a><span class="fu">plan</span>(sequential)</span></code></pre></div>
<p>The joint estimation of the 99 series takes about 38.2916818 minutes.</p>
<p>We avoid the <code>summary</code> method for such a large object, and instead print out the coefficients and the performance metrics:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="tsvets.html#cb167-1" aria-hidden="true" tabindex="-1"></a>cf <span class="ot">&lt;-</span> <span class="fu">coef</span>(mod)</span>
<span id="cb167-2"><a href="tsvets.html#cb167-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(data.table<span class="sc">::</span><span class="fu">data.table</span>(<span class="at">Coefficient =</span> <span class="fu">names</span>(cf), <span class="at">Value =</span> <span class="fu">round</span>(cf,<span class="dv">4</span>)))</span></code></pre></div>
<pre><code>##              Coefficient  Value
##                   &lt;char&gt;  &lt;num&gt;
##  1:     Level[Group = 1] 0.4452
##  2:     Level[Group = 2] 0.5126
##  3:     Level[Group = 3] 0.7164
##  4:     Level[Group = 4] 0.6882
##  5:     Level[Group = 5] 0.1651
##  6:     Level[Group = 6] 0.5261
##  7:     Level[Group = 7] 0.5494
##  8:     Level[Group = 8] 0.4238
##  9:     Level[Group = 9] 0.5011
## 10:    Level[Group = 10] 0.5850
## 11:    Level[Group = 11] 0.7356
## 12:    Level[Group = 12] 0.4934
## 13:    Level[Group = 13] 0.7173
## 14:     Slope[Group = 1] 0.0000
## 15:     Slope[Group = 2] 0.0000
## 16:     Slope[Group = 3] 0.0000
## 17:     Slope[Group = 4] 0.0000
## 18:     Slope[Group = 5] 0.0067
## 19:     Slope[Group = 6] 0.0000
## 20:     Slope[Group = 7] 0.0000
## 21:     Slope[Group = 8] 0.0000
## 22:     Slope[Group = 9] 0.0000
## 23:    Slope[Group = 10] 0.0061
## 24:    Slope[Group = 11] 0.0000
## 25:    Slope[Group = 12] 0.0000
## 26:    Slope[Group = 13] 0.0000
## 27:  Seasonal[Group = 1] 0.3373
## 28:  Seasonal[Group = 2] 0.2047
## 29:  Seasonal[Group = 3] 0.0000
## 30:  Seasonal[Group = 4] 0.0000
## 31:  Seasonal[Group = 5] 0.1315
## 32:  Seasonal[Group = 6] 0.2795
## 33:  Seasonal[Group = 7] 0.0000
## 34:  Seasonal[Group = 8] 0.3143
## 35:  Seasonal[Group = 9] 0.3885
## 36: Seasonal[Group = 10] 0.0000
## 37: Seasonal[Group = 11] 0.0000
## 38: Seasonal[Group = 12] 0.2692
## 39: Seasonal[Group = 13] 0.0013
##              Coefficient  Value</code></pre>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="tsvets.html#cb169-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tsmetrics</span>(mod)</span></code></pre></div>
<pre><code>##       N no_pars    LogLik       AIC      BIC     AICc       MAPE       MSLRE
## 1 22572    1425 -7613.512 -4763.512 6671.351 -4571.32 0.04063859 0.003203836
##         WAPE       WSLRE
## 1 0.04063859 0.003203836</code></pre>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="tsvets.html#cb171-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">series =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)[groups <span class="sc">==</span> <span class="dv">4</span>])</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-23-1.png" width="768" /></p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="tsvets.html#cb172-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">series =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)[groups <span class="sc">==</span> <span class="dv">4</span>], <span class="at">type =</span> <span class="st">&quot;states&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-23-2.png" width="768" /></p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="tsvets.html#cb173-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">series =</span> (<span class="dv">1</span><span class="sc">:</span><span class="dv">99</span>)[groups <span class="sc">==</span> <span class="dv">4</span>], <span class="at">type =</span> <span class="st">&quot;residuals&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-23-3.png" width="768" /></p>
</div>
<div id="tsvets:demonstration:example3" class="section level3 hasAnchor" number="6.7.4">
<h3><span class="header-section-number">6.7.4</span> Example: Australian Retail Sales Filtering<a href="tsvets.html#tsvets:demonstration:example3" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This example highlights the use of the <code>tsfilter</code> method for online filtering
as already discussed in Sections <a href="tsets.html#tsets:demonstration:filtering">4.6.4</a> and <a href="tsissm.html#tsissm:demonstration:filtering">5.5.5</a>.</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="tsvets.html#cb174-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tsvets)))</span>
<span id="cb174-2"><a href="tsvets.html#cb174-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsmethods))</span>
<span id="cb174-3"><a href="tsvets.html#cb174-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsaux))</span>
<span id="cb174-4"><a href="tsvets.html#cb174-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(xts))</span>
<span id="cb174-5"><a href="tsvets.html#cb174-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb174-6"><a href="tsvets.html#cb174-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(austretail[,<span class="fu">grepl</span>(<span class="st">&quot;NEWS&quot;</span>, <span class="fu">colnames</span>(austretail))])</span>
<span id="cb174-7"><a href="tsvets.html#cb174-7" aria-hidden="true" tabindex="-1"></a>y_train <span class="ot">&lt;-</span> y[<span class="dv">1</span><span class="sc">:</span>(<span class="dv">369</span> <span class="sc">-</span> <span class="dv">24</span>)]</span>
<span id="cb174-8"><a href="tsvets.html#cb174-8" aria-hidden="true" tabindex="-1"></a>y_test <span class="ot">&lt;-</span> y[(<span class="dv">369</span> <span class="sc">-</span> <span class="dv">24</span> <span class="sc">+</span> <span class="dv">1</span>)<span class="sc">:</span><span class="dv">369</span>]</span>
<span id="cb174-9"><a href="tsvets.html#cb174-9" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">vets_modelspec</span>(y_train, <span class="at">level =</span> <span class="st">&quot;common&quot;</span>, <span class="at">slope =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="at">damped =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb174-10"><a href="tsvets.html#cb174-10" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seasonal =</span> <span class="st">&quot;common&quot;</span>, <span class="at">lambda =</span> <span class="fl">0.5</span>, <span class="at">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, </span>
<span id="cb174-11"><a href="tsvets.html#cb174-11" aria-hidden="true" tabindex="-1"></a>                       <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb174-12"><a href="tsvets.html#cb174-12" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate</span>(spec, <span class="at">solver =</span> <span class="st">&quot;nlminb&quot;</span>)</span>
<span id="cb174-13"><a href="tsvets.html#cb174-13" aria-hidden="true" tabindex="-1"></a>filt <span class="ot">&lt;-</span> <span class="fu">tsfilter</span>(mod, <span class="at">y =</span> y_test)</span>
<span id="cb174-14"><a href="tsvets.html#cb174-14" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(<span class="fu">fitted</span>(mod))</span></code></pre></div>
<pre><code>##            ACF.NEWS  NSW.NEWS  NT.NEWS   Q.NEWS   SA.NEWS   T.NEWS   V.NEWS
## 2016-07-31 6.274802  85.48929 1.563078 51.79401 12.263423 12.41307 47.63892
## 2016-08-31 5.822149  87.91927 1.518185 54.59904 10.952639 12.97214 47.66849
## 2016-09-30 4.902062  81.27385 1.394669 51.86892  9.940538 13.71905 45.84748
## 2016-10-31 4.791341  83.27201 1.319689 55.07794  9.960859 12.42058 49.48286
## 2016-11-30 5.547111  86.93625 1.357322 54.95787 10.368365 12.07245 50.89754
## 2016-12-31 8.184714 116.27851 1.858932 72.01650 15.622342 14.69097 76.20901
##             WA.NEWS
## 2016-07-31 40.75596
## 2016-08-31 42.52751
## 2016-09-30 39.24565
## 2016-10-31 40.45786
## 2016-11-30 41.79131
## 2016-12-31 55.58459</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="tsvets.html#cb176-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">tail</span>(<span class="fu">fitted</span>(filt), <span class="dv">24</span> <span class="sc">+</span> <span class="dv">1</span>), <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##            ACF.NEWS  NSW.NEWS  NT.NEWS   Q.NEWS   SA.NEWS   T.NEWS   V.NEWS
## 2016-12-31 8.184714 116.27851 1.858932 72.01650 15.622342 14.69097 76.20901
## 2017-01-31 5.136207  92.07696 1.239745 57.96096  8.790413 12.48530 47.68477
## 2017-02-28 7.150196  94.62244 1.098936 52.06101  9.564020 13.50578 47.71324
## 2017-03-31 5.671755  98.44475 1.105181 54.21634 11.124740 11.63927 52.55807
## 2017-04-30 4.718627  82.17766 1.158383 51.48423  8.319089 10.94583 47.45609
##             WA.NEWS
## 2016-12-31 55.58459
## 2017-01-31 48.38624
## 2017-02-28 40.52982
## 2017-03-31 40.46546
## 2017-04-30 37.86586</code></pre>
</div>
<div id="tsvets:demonstration:example4" class="section level3 hasAnchor" number="6.7.5">
<h3><span class="header-section-number">6.7.5</span> Example: Australian Retail Sales Aggregation<a href="tsvets.html#tsvets:demonstration:example4" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This demonstrates the ability to aggregate a model estimated with homogeneous coefficients.
We continue with the retail sales data, which being a set of flow variables, can be aggregated.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="tsvets.html#cb178-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">suppressPackageStartupMessages</span>(<span class="fu">library</span>(tsvets)))</span>
<span id="cb178-2"><a href="tsvets.html#cb178-2" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsmethods))</span>
<span id="cb178-3"><a href="tsvets.html#cb178-3" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(tsaux))</span>
<span id="cb178-4"><a href="tsvets.html#cb178-4" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressMessages</span>(<span class="fu">library</span>(xts))</span>
<span id="cb178-5"><a href="tsvets.html#cb178-5" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb178-6"><a href="tsvets.html#cb178-6" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(austretail[,<span class="fu">grepl</span>(<span class="st">&quot;NEWS&quot;</span>, <span class="fu">colnames</span>(austretail))])</span></code></pre></div>
<p>We use a vector of ones as weights, to denote summation to the total for the News category.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="tsvets.html#cb179-1" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>)</span></code></pre></div>
<p>Additionally, we also include, purely for expositional purposes, a matrix of 5 randomly generated regressors:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="tsvets.html#cb180-1" aria-hidden="true" tabindex="-1"></a>xreg <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="fu">nrow</span>(y) <span class="sc">*</span> <span class="dv">5</span>), <span class="at">nrow =</span> <span class="fu">nrow</span>(y), <span class="at">ncol =</span> <span class="dv">5</span>), <span class="fu">index</span>(y))</span>
<span id="cb180-2"><a href="tsvets.html#cb180-2" aria-hidden="true" tabindex="-1"></a>xreg_include <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">2</span>, <span class="at">ncol =</span> <span class="dv">5</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(y))</span>
<span id="cb180-3"><a href="tsvets.html#cb180-3" aria-hidden="true" tabindex="-1"></a>xreg_include[<span class="dv">2</span>,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">1</span></span></code></pre></div>
<p>Setting the include matrix to the value of 2 means pooling, and we also set regressor 1 for series 2 to a value of 1 in order to denote that we want this to be estimated seperately (non-pooled).</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="tsvets.html#cb181-1" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">vets_modelspec</span>(y, <span class="at">level =</span> <span class="st">&quot;common&quot;</span>,  <span class="at">slope =</span> <span class="st">&quot;common&quot;</span>, <span class="at">seasonal =</span> <span class="st">&quot;common&quot;</span>, </span>
<span id="cb181-2"><a href="tsvets.html#cb181-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="at">frequency =</span> <span class="dv">12</span>, <span class="at">xreg =</span> xreg,</span>
<span id="cb181-3"><a href="tsvets.html#cb181-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xreg_include =</span> xreg_include)</span>
<span id="cb181-4"><a href="tsvets.html#cb181-4" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate</span>(spec, <span class="at">solver =</span> <span class="st">&quot;nlminb&quot;</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>We can extract specific matrices from the estimate object using the as yet unexported function <code>p_matrix</code>:</p>
<div class="sourceCode" id="cb182"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb182-1"><a href="tsvets.html#cb182-1" aria-hidden="true" tabindex="-1"></a>tsvets<span class="sc">:::</span><span class="fu">p_matrix</span>(mod)<span class="sc">$</span>X</span></code></pre></div>
<pre><code>## 8 x 5 Matrix of class &quot;dgeMatrix&quot;
##                   x1          x2         x3            x4          x5
## ACF.NEWS  0.01394335 -0.01667844 -0.0268727 -0.0004924587 -0.01555726
## NSW.NEWS -0.35119906 -0.01667844 -0.0268727 -0.0004924587 -0.01555726
## NT.NEWS   0.01394335 -0.01667844 -0.0268727 -0.0004924587 -0.01555726
## Q.NEWS    0.01394335 -0.01667844 -0.0268727 -0.0004924587 -0.01555726
## SA.NEWS   0.01394335 -0.01667844 -0.0268727 -0.0004924587 -0.01555726
## T.NEWS    0.01394335 -0.01667844 -0.0268727 -0.0004924587 -0.01555726
## V.NEWS    0.01394335 -0.01667844 -0.0268727 -0.0004924587 -0.01555726
## WA.NEWS   0.01394335 -0.01667844 -0.0268727 -0.0004924587 -0.01555726</code></pre>
<p>where we can observe that the coefficients for each regressor have been pooled, with the exception of <code>x1</code> for the NSW.NEWS series.</p>
<p>We can now proceed to aggregate the model using the <code>tsaggregate</code> method on the estimated object:</p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="tsvets.html#cb184-1" aria-hidden="true" tabindex="-1"></a>mod_aggregate <span class="ot">&lt;-</span> <span class="fu">tsaggregate</span>(mod, <span class="at">weights =</span> weights, <span class="at">return_model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb184-2"><a href="tsvets.html#cb184-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_aggregate)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : common 
## Seasonal : common 
## Dependence : diagonal 
## No. Series : 1 
## No. TimePoints : 369 
## 
## Parameter Matrices
## 
## Level Matrix
## 1 x 1 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]     
## [1,] 0.6224697
## 
## Slope Matrix
## 1 x 1 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1] 
## [1,] 1e-12
## 
## Seasonal Matrix
## 1 x 1 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]     
## [1,] 0.1257502
## 
## Regressor Matrix
## 1 x 5 Matrix of class &quot;dgeMatrix&quot;
##                   x1         x2         x3           x4         x5
## aggregate -0.2535956 -0.1334275 -0.2149816 -0.003939669 -0.1244581
## 
## Covariance Matrix
## 1 x 1 diagonal matrix of class &quot;ddiMatrix&quot;
##           aggregate
## aggregate  222.3031
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0352   0.0352
## MSLRE 0.0021   0.0021</code></pre>
<div class="sourceCode" id="cb186"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb186-1"><a href="tsvets.html#cb186-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod_aggregate)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-29-1.png" width="768" /></p>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="tsvets.html#cb187-1" aria-hidden="true" tabindex="-1"></a><span class="fu">suppressWarnings</span>(<span class="fu">plot</span>(mod_aggregate, <span class="at">type =</span> <span class="st">&quot;states&quot;</span>))</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-29-2.png" width="768" /></p>
<p>We can then proceed with prediction as well as simulation, both of which allow for the outputs to be aggregated. Alternatively, since we now have an aggregated model object, we can also predict or simulate directly from that object.</p>
<div class="sourceCode" id="cb188"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb188-1"><a href="tsvets.html#cb188-1" aria-hidden="true" tabindex="-1"></a>newxreg <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="dv">24</span> <span class="sc">*</span> <span class="dv">5</span>), <span class="at">nrow =</span> <span class="dv">24</span>, <span class="at">ncol =</span> <span class="dv">5</span>), </span>
<span id="cb188-2"><a href="tsvets.html#cb188-2" aria-hidden="true" tabindex="-1"></a>               <span class="fu">future_dates</span>(<span class="fu">tail</span>(<span class="fu">index</span>(y),<span class="dv">1</span>),<span class="st">&quot;months&quot;</span>,<span class="dv">24</span>))</span>
<span id="cb188-3"><a href="tsvets.html#cb188-3" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod, <span class="at">newxreg =</span> newxreg)</span>
<span id="cb188-4"><a href="tsvets.html#cb188-4" aria-hidden="true" tabindex="-1"></a>p_agg_series <span class="ot">&lt;-</span> <span class="fu">tsaggregate</span>(p, <span class="at">weights =</span> weights)</span>
<span id="cb188-5"><a href="tsvets.html#cb188-5" aria-hidden="true" tabindex="-1"></a>p_agg_model <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_aggregate, <span class="at">newxreg =</span> newxreg)</span>
<span id="cb188-6"><a href="tsvets.html#cb188-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p_agg_series<span class="sc">$</span>distribution, <span class="at">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="at">interval_color =</span> <span class="st">&quot;grey&quot;</span>, </span>
<span id="cb188-7"><a href="tsvets.html#cb188-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">main =</span> <span class="st">&quot;Agggregated Model&quot;</span>)</span>
<span id="cb188-8"><a href="tsvets.html#cb188-8" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p_agg_model<span class="sc">$</span>prediction_table[<span class="dv">1</span>]<span class="sc">$</span>Predicted[[<span class="dv">1</span>]]<span class="sc">$</span>distribution, </span>
<span id="cb188-9"><a href="tsvets.html#cb188-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">median_color =</span> <span class="dv">2</span>, </span>
<span id="cb188-10"><a href="tsvets.html#cb188-10" aria-hidden="true" tabindex="-1"></a>     <span class="at">interval_color =</span> <span class="st">&quot;grey10&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>As we can observe, the output of the 2 predictions is identical (subject to some randomness from the simulation of the predictive distribution). We do the same for the simulation method:</p>
<div class="sourceCode" id="cb189"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb189-1"><a href="tsvets.html#cb189-1" aria-hidden="true" tabindex="-1"></a>s <span class="ot">&lt;-</span> <span class="fu">simulate</span>(mod, <span class="at">nsim =</span> <span class="dv">100</span>, <span class="at">h =</span> <span class="dv">24</span>, <span class="at">newxreg =</span> newxreg, <span class="at">seed =</span> <span class="dv">700</span>)</span>
<span id="cb189-2"><a href="tsvets.html#cb189-2" aria-hidden="true" tabindex="-1"></a>s_agg_series <span class="ot">&lt;-</span> <span class="fu">tsaggregate</span>(s, <span class="at">weights =</span> weights)</span>
<span id="cb189-3"><a href="tsvets.html#cb189-3" aria-hidden="true" tabindex="-1"></a>s_agg_model <span class="ot">&lt;-</span> <span class="fu">simulate</span>(mod_aggregate, <span class="at">nsim =</span> <span class="dv">100</span>, <span class="at">h =</span> <span class="dv">24</span>, <span class="at">newxreg =</span> newxreg,</span>
<span id="cb189-4"><a href="tsvets.html#cb189-4" aria-hidden="true" tabindex="-1"></a>                        <span class="at">seed =</span> <span class="dv">700</span>)</span>
<span id="cb189-5"><a href="tsvets.html#cb189-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_agg_series<span class="sc">$</span>distribution, <span class="at">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, </span>
<span id="cb189-6"><a href="tsvets.html#cb189-6" aria-hidden="true" tabindex="-1"></a>     <span class="at">interval_color =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb189-7"><a href="tsvets.html#cb189-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(s_agg_model<span class="sc">$</span>simulation_table[<span class="dv">1</span>]<span class="sc">$</span>Simulated[[<span class="dv">1</span>]]<span class="sc">$</span>distribution, </span>
<span id="cb189-8"><a href="tsvets.html#cb189-8" aria-hidden="true" tabindex="-1"></a>     <span class="at">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>, <span class="at">median_color =</span> <span class="dv">2</span>, </span>
<span id="cb189-9"><a href="tsvets.html#cb189-9" aria-hidden="true" tabindex="-1"></a>     <span class="at">interval_color =</span> <span class="st">&quot;grey10&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
</div>
<div id="tsvets:demonstration:example6" class="section level3 hasAnchor" number="6.7.6">
<h3><span class="header-section-number">6.7.6</span> Example: Groupwise Pooling<a href="tsvets.html#tsvets:demonstration:example6" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>It is also possible to have group wise pooling. We saw above that we could specify
pooling using the number of series times number of regressors matrix,
<code>xreg_include</code>, with values <code>0</code>, <code>1</code> or <code>2+</code> (0 = no beta, 1 = individual beta and
2+ = grouped beta). Group pooling can be achieved by setting values of 2+.
For instance 2 series sharing one pooled estimate, and 3 other
series sharing another grouped estimate would have values of
(2,2,3,3,3).</p>
<p>In the following example we have 8 series and 2 regressors, with different
combinations of pooling.</p>
<div class="sourceCode" id="cb190"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb190-1"><a href="tsvets.html#cb190-1" aria-hidden="true" tabindex="-1"></a>xreg <span class="ot">&lt;-</span> <span class="fu">xts</span>(<span class="fu">matrix</span>(<span class="fu">rnorm</span>(<span class="fu">nrow</span>(y)<span class="sc">*</span><span class="dv">2</span>), <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="fu">nrow</span>(y)), <span class="fu">index</span>(y))</span>
<span id="cb190-2"><a href="tsvets.html#cb190-2" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xreg) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;B1&quot;</span>,<span class="st">&quot;B2&quot;</span>)</span>
<span id="cb190-3"><a href="tsvets.html#cb190-3" aria-hidden="true" tabindex="-1"></a>xreg_include <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span>, <span class="at">ncol =</span> <span class="dv">2</span>, <span class="at">nrow =</span> <span class="fu">ncol</span>(y))</span>
<span id="cb190-4"><a href="tsvets.html#cb190-4" aria-hidden="true" tabindex="-1"></a><span class="fu">rownames</span>(xreg_include) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(y)</span>
<span id="cb190-5"><a href="tsvets.html#cb190-5" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(xreg_include) <span class="ot">&lt;-</span> <span class="fu">colnames</span>(xreg)</span>
<span id="cb190-6"><a href="tsvets.html#cb190-6" aria-hidden="true" tabindex="-1"></a><span class="co"># individual [1,1], grouped 2:3, 5:6 and 7:8</span></span>
<span id="cb190-7"><a href="tsvets.html#cb190-7" aria-hidden="true" tabindex="-1"></a>xreg_include[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>),<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb190-8"><a href="tsvets.html#cb190-8" aria-hidden="true" tabindex="-1"></a>xreg_include[<span class="fu">c</span>(<span class="dv">5</span><span class="sc">:</span><span class="dv">6</span>),<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb190-9"><a href="tsvets.html#cb190-9" aria-hidden="true" tabindex="-1"></a>xreg_include[<span class="fu">c</span>(<span class="dv">7</span><span class="sc">:</span><span class="dv">8</span>),<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="dv">4</span></span>
<span id="cb190-10"><a href="tsvets.html#cb190-10" aria-hidden="true" tabindex="-1"></a><span class="co"># individual 1, zero for 2:3, group for 4:8</span></span>
<span id="cb190-11"><a href="tsvets.html#cb190-11" aria-hidden="true" tabindex="-1"></a>xreg_include[<span class="fu">c</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>),<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">0</span></span>
<span id="cb190-12"><a href="tsvets.html#cb190-12" aria-hidden="true" tabindex="-1"></a>xreg_include[<span class="fu">c</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">8</span>),<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="dv">3</span></span>
<span id="cb190-13"><a href="tsvets.html#cb190-13" aria-hidden="true" tabindex="-1"></a>xreg_include</span></code></pre></div>
<pre><code>##          B1 B2
## ACF.NEWS  1  1
## NSW.NEWS  2  0
## NT.NEWS   2  0
## Q.NEWS    1  3
## SA.NEWS   3  3
## T.NEWS    3  3
## V.NEWS    4  3
## WA.NEWS   4  3</code></pre>
<div class="sourceCode" id="cb192"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb192-1"><a href="tsvets.html#cb192-1" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">vets_modelspec</span>(y, <span class="at">level =</span> <span class="st">&quot;grouped&quot;</span>, <span class="at">slope =</span> <span class="st">&quot;grouped&quot;</span>, </span>
<span id="cb192-2"><a href="tsvets.html#cb192-2" aria-hidden="true" tabindex="-1"></a>                       <span class="at">group =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">4</span>), <span class="at">damped =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb192-3"><a href="tsvets.html#cb192-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">seasonal =</span> <span class="st">&quot;grouped&quot;</span>, <span class="at">xreg =</span> xreg, </span>
<span id="cb192-4"><a href="tsvets.html#cb192-4" aria-hidden="true" tabindex="-1"></a>                       <span class="at">xreg_include =</span> xreg_include, <span class="at">lambda =</span> <span class="dv">0</span>, </span>
<span id="cb192-5"><a href="tsvets.html#cb192-5" aria-hidden="true" tabindex="-1"></a>                       <span class="at">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="at">frequency =</span> <span class="dv">12</span>)</span>
<span id="cb192-6"><a href="tsvets.html#cb192-6" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate</span>(spec, <span class="at">solver =</span> <span class="st">&quot;nlminb&quot;</span>)</span></code></pre></div>
<p>Note that the Box Cox parameter <code>lambda</code> should be the same for the grouped
series else the coefficients should not be pooled (as they have different scales).</p>
</div>
<div id="tsvets:demonstration:example5" class="section level3 hasAnchor" number="6.7.7">
<h3><span class="header-section-number">6.7.7</span> Example: Price Volume Aggregation<a href="tsvets.html#tsvets:demonstration:example5" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This final example shows how to jointly model a series based on price-volume relationship with a target of generating a model for Sales:
<span class="math inline">\(Sales = Price\times Volume\)</span></p>
<p>While this is a multiplicative model, if we were to model the series using a log transformation we would be able to aggregate the model in logs before exponentiating to recover the Sales as the example will demonstrate.</p>
<div class="sourceCode" id="cb193"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb193-1"><a href="tsvets.html#cb193-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(<span class="st">&quot;priceunits&quot;</span>, <span class="at">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb193-2"><a href="tsvets.html#cb193-2" aria-hidden="true" tabindex="-1"></a>spec <span class="ot">&lt;-</span> <span class="fu">vets_modelspec</span>(priceunits, <span class="at">level =</span> <span class="st">&quot;common&quot;</span>, <span class="at">slope =</span> <span class="st">&quot;common&quot;</span>, <span class="at">frequency =</span> <span class="dv">12</span>, </span>
<span id="cb193-3"><a href="tsvets.html#cb193-3" aria-hidden="true" tabindex="-1"></a>                       <span class="at">lambda =</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="at">dependence =</span> <span class="st">&quot;full&quot;</span>)</span>
<span id="cb193-4"><a href="tsvets.html#cb193-4" aria-hidden="true" tabindex="-1"></a>mod <span class="ot">&lt;-</span> <span class="fu">estimate</span>(spec, <span class="at">solver =</span> <span class="st">&quot;optim&quot;</span>, <span class="at">control =</span> <span class="fu">list</span>(<span class="at">trace =</span> <span class="dv">0</span>))</span>
<span id="cb193-5"><a href="tsvets.html#cb193-5" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : common 
## Seasonal : none 
## Dependence : full 
## No. Series : 2 
## No. TimePoints : 100 
## 
## Parameter Matrices
## 
## Level Matrix
## 2 x 2 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]      [,2]     
## [1,] 0.3900419         .
## [2,]         . 0.3900419
## 
## Slope Matrix
## 2 x 2 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]       [,2]      
## [1,] 0.09196964          .
## [2,]          . 0.09196964
## 
## Correlation Matrix
## 2 x 2 Matrix of class &quot;dsyMatrix&quot;
##            price      units
## price  1.0000000 -0.5939792
## units -0.5939792  1.0000000
## 
## Information Criteria
##  AIC    BIC    AICc  
##  162.58 182.37 163.02
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0508   0.0508
## MSLRE 0.0042   0.0042</code></pre>
<div class="sourceCode" id="cb195"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb195-1"><a href="tsvets.html#cb195-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-35-1.png" width="768" /></p>
<div class="sourceCode" id="cb196"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb196-1"><a href="tsvets.html#cb196-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mod, <span class="at">type =</span> <span class="st">&quot;states&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-35-2.png" width="768" /></p>
<div class="sourceCode" id="cb197"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb197-1"><a href="tsvets.html#cb197-1" aria-hidden="true" tabindex="-1"></a>weights <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb197-2"><a href="tsvets.html#cb197-2" aria-hidden="true" tabindex="-1"></a>mod_aggregate <span class="ot">&lt;-</span> <span class="fu">tsaggregate</span>(mod, <span class="at">weights =</span> weights, <span class="at">return_model =</span> <span class="cn">TRUE</span>)</span>
<span id="cb197-3"><a href="tsvets.html#cb197-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mod_aggregate)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : common 
## Seasonal : none 
## Dependence : diagonal 
## No. Series : 1 
## No. TimePoints : 100 
## 
## Parameter Matrices
## 
## Level Matrix
## 1 x 1 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]     
## [1,] 0.3900419
## 
## Slope Matrix
## 1 x 1 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]      
## [1,] 0.09196964
## 
## Covariance Matrix
## 1 x 1 diagonal matrix of class &quot;ddiMatrix&quot;
##             aggregate
## aggregate 0.003901452
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0496   0.0496
## MSLRE 0.0039   0.0039</code></pre>
<div class="sourceCode" id="cb199"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb199-1"><a href="tsvets.html#cb199-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod,  <span class="at">h =</span> <span class="dv">24</span>, <span class="at">nsim =</span> <span class="dv">5000</span>)</span>
<span id="cb199-2"><a href="tsvets.html#cb199-2" aria-hidden="true" tabindex="-1"></a>p_agg_model <span class="ot">&lt;-</span> <span class="fu">predict</span>(mod_aggregate, <span class="at">h =</span> <span class="dv">24</span>, <span class="at">nsim =</span> <span class="dv">5000</span>)</span>
<span id="cb199-3"><a href="tsvets.html#cb199-3" aria-hidden="true" tabindex="-1"></a>p_agg_series <span class="ot">&lt;-</span> <span class="fu">tsaggregate</span>(p, <span class="at">weights =</span> weights)</span>
<span id="cb199-4"><a href="tsvets.html#cb199-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p_agg_model<span class="sc">$</span>prediction_table[<span class="dv">1</span>]<span class="sc">$</span>Predicted[[<span class="dv">1</span>]]<span class="sc">$</span>distribution, </span>
<span id="cb199-5"><a href="tsvets.html#cb199-5" aria-hidden="true" tabindex="-1"></a>     <span class="at">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="at">interval_color =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb199-6"><a href="tsvets.html#cb199-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(p_agg_series<span class="sc">$</span>distribution, <span class="at">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="at">add =</span> <span class="cn">TRUE</span>,</span>
<span id="cb199-7"><a href="tsvets.html#cb199-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">median_color =</span> <span class="dv">2</span>, <span class="at">interval_color =</span> <span class="st">&quot;grey10&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-37-1.png" width="672" /></p>
<p>In the presence of a non-homogeneous model, or a homogeneous model with Box Cox parameter not equal to either 0 (log) or 1 (no transform), then the <code>tsaggregate</code> method will still work but the <code>return_model</code> arguments needs to be set to <code>FALSE</code> and the resulting output will just be the aggregated series.</p>

</div>
</div>
</div>
<h3>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-athanasopoulos2012" class="csl-entry">
Athanasopoulos, George, and Ashton de Silva. 2012. <span>“Multivariate Exponential Smoothing for Forecasting Tourist Arrivals.”</span> <em>Journal of Travel Research</em> 51 (5): 640–52.
</div>
<div id="ref-R-Matrix" class="csl-entry">
Bates, Douglas, Martin Maechler, and Mikael Jagan. 2022. <em>Matrix: Sparse and Dense Matrix Classes and Methods</em>. <a href="https://R-Forge.R-project.org/projects/matrix/">https://R-Forge.R-project.org/projects/matrix/</a>.
</div>
<div id="ref-clements2015benefits" class="csl-entry">
Clements, Adam, Ayesha Scott, and Annastiina Silvennoinen. 2015. <span>“On the Benefits of Equicorrelation for Portfolio Allocation.”</span> <em>Journal of Forecasting</em> 34 (6): 507–22.
</div>
<div id="ref-desilva2010" class="csl-entry">
De Silva, Ashton, Rob J Hyndman, and Ralph Snyder. 2010. <span>“The Vector Innovations Structural Time Series Framework: A Simple Approach to Multivariate Forecasting.”</span> <em>Statistical Modelling</em> 10 (4): 353–74.
</div>
<div id="ref-R-car" class="csl-entry">
Fox, John, Sanford Weisberg, and Brad Price. 2022. <em>Car: Companion to Applied Regression</em>. <a href="https://CRAN.R-project.org/package=car">https://CRAN.R-project.org/package=car</a>.
</div>
<div id="ref-hyndman2008" class="csl-entry">
Hyndman, Rob, Anne B Koehler, J Keith Ord, and Ralph D Snyder. 2008. <em>Forecasting with Exponential Smoothing: The State Space Approach</em>. Springer Science &amp; Business Media.
</div>
<div id="ref-R-MVN" class="csl-entry">
Korkmaz, Selcuk, Dincer Goksuluk, and Gokmen Zararsiz. 2021. <em>MVN: Multivariate Normality Tests</em>. <a href="https://CRAN.R-project.org/package=MVN">https://CRAN.R-project.org/package=MVN</a>.
</div>
<div id="ref-ledoit2004well" class="csl-entry">
Ledoit, Olivier, and Michael Wolf. 2004. <span>“A Well-Conditioned Estimator for Large-Dimensional Covariance Matrices.”</span> <em>Journal of Multivariate Analysis</em> 88 (2): 365–411.
</div>
<div id="ref-velilla1993note" class="csl-entry">
Velilla, Santiago. 1993. <span>“A Note on the Multivariate Box—Cox Transformation to Normality.”</span> <em>Statistics &amp; Probability Letters</em> 17 (4): 259–63.
</div>
</div>
<div class="footnotes">
<hr />
<ol start="15">
<li id="fn15"><p>See section 17.4.1 of <span class="citation">R. Hyndman et al. (<a href="#ref-hyndman2008" role="doc-biblioref">2008</a>)</span>.<a href="tsvets.html#fnref15" class="footnote-back">↩︎</a></p></li>
<li id="fn16"><p>Which will almost surely lead to invertibility problems if they are all sampled at their extremes, but we prefer to catch that case with the barrier constraint rather than enforcing difficult to implement row-wise constraints on each matrix.<a href="tsvets.html#fnref16" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tsissm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tsforeign.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
