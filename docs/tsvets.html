<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 tsvets package | A Time Series Framework</title>
  <meta name="description" content="Documentation for the tsmodels framework" />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 tsvets package | A Time Series Framework" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Documentation for the tsmodels framework" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 tsvets package | A Time Series Framework" />
  
  <meta name="twitter:description" content="Documentation for the tsmodels framework" />
  

<meta name="author" content="The tsmodels team" />


<meta name="date" content="2020-09-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="tsissm.html"/>
<link rel="next" href="tsforeign.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Time Series Forecasting Framework</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="installation.html"><a href="installation.html"><i class="fa fa-check"></i><b>2</b> Installation</a></li>
<li class="chapter" data-level="3" data-path="the-tsmodels-team.html"><a href="the-tsmodels-team.html"><i class="fa fa-check"></i><b>3</b> The tsmodels team</a></li>
<li class="chapter" data-level="4" data-path="tsmethods.html"><a href="tsmethods.html"><i class="fa fa-check"></i><b>4</b> tsmethods package</a><ul>
<li class="chapter" data-level="4.1" data-path="tsmethods.html"><a href="tsmethods.html#introduction"><i class="fa fa-check"></i><b>4.1</b> Introduction</a></li>
<li class="chapter" data-level="4.2" data-path="tsmethods.html"><a href="tsmethods.html#tsmethods-simulation"><i class="fa fa-check"></i><b>4.2</b> Ensembling of Forecast Distributions</a></li>
<li class="chapter" data-level="4.3" data-path="tsmethods.html"><a href="tsmethods.html#demonstration"><i class="fa fa-check"></i><b>4.3</b> Demonstration</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="tsets.html"><a href="tsets.html"><i class="fa fa-check"></i><b>5</b> tsets package</a><ul>
<li class="chapter" data-level="5.1" data-path="tsets.html"><a href="tsets.html#tsets:intro"><i class="fa fa-check"></i><b>5.1</b> Introduction</a></li>
<li class="chapter" data-level="5.2" data-path="tsets.html"><a href="tsets.html#tsets:taxonomy"><i class="fa fa-check"></i><b>5.2</b> Taxonomy of Models</a></li>
<li class="chapter" data-level="5.3" data-path="tsets.html"><a href="tsets.html#tsets:extensions"><i class="fa fa-check"></i><b>5.3</b> Extensions</a></li>
<li class="chapter" data-level="5.4" data-path="tsets.html"><a href="tsets.html#some-encompasing-alternatives"><i class="fa fa-check"></i><b>5.4</b> Some Encompasing Alternatives</a></li>
<li class="chapter" data-level="5.5" data-path="tsets.html"><a href="tsets.html#tsets:implementation"><i class="fa fa-check"></i><b>5.5</b> Package Implementation</a><ul>
<li class="chapter" data-level="5.5.1" data-path="tsets.html"><a href="tsets.html#tsets:implementation:constraints"><i class="fa fa-check"></i><b>5.5.1</b> Constraints</a></li>
<li class="chapter" data-level="5.5.2" data-path="tsets.html"><a href="tsets.html#tsets:implementation:initialization"><i class="fa fa-check"></i><b>5.5.2</b> Initialization</a></li>
<li class="chapter" data-level="5.5.3" data-path="tsets.html"><a href="tsets.html#tsets:implementation:transformations"><i class="fa fa-check"></i><b>5.5.3</b> Transformations</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="tsets.html"><a href="tsets.html#tsets:demonstration"><i class="fa fa-check"></i><b>5.6</b> Demonstration</a><ul>
<li class="chapter" data-level="5.6.1" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:specification"><i class="fa fa-check"></i><b>5.6.1</b> The specification object</a></li>
<li class="chapter" data-level="5.6.2" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:estimation"><i class="fa fa-check"></i><b>5.6.2</b> Estimation</a></li>
<li class="chapter" data-level="5.6.3" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:prediction"><i class="fa fa-check"></i><b>5.6.3</b> Prediction</a></li>
<li class="chapter" data-level="5.6.4" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:filtering"><i class="fa fa-check"></i><b>5.6.4</b> Filtering</a></li>
<li class="chapter" data-level="5.6.5" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:simulation"><i class="fa fa-check"></i><b>5.6.5</b> Simulation</a></li>
<li class="chapter" data-level="5.6.6" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:profiling"><i class="fa fa-check"></i><b>5.6.6</b> Profiling</a></li>
<li class="chapter" data-level="5.6.7" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:backtesting"><i class="fa fa-check"></i><b>5.6.7</b> Backtesting</a></li>
<li class="chapter" data-level="5.6.8" data-path="tsets.html"><a href="tsets.html#tsets:demonstration:benchmarking"><i class="fa fa-check"></i><b>5.6.8</b> Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="tsissm.html"><a href="tsissm.html"><i class="fa fa-check"></i><b>6</b> tsissm package</a><ul>
<li class="chapter" data-level="6.1" data-path="tsissm.html"><a href="tsissm.html#tsissm:introduction"><i class="fa fa-check"></i><b>6.1</b> Introduction</a></li>
<li class="chapter" data-level="6.2" data-path="tsissm.html"><a href="tsissm.html#tsissm:initialization"><i class="fa fa-check"></i><b>6.2</b> State Initialization</a></li>
<li class="chapter" data-level="6.3" data-path="tsissm.html"><a href="tsissm.html#tsissm:likelihood"><i class="fa fa-check"></i><b>6.3</b> Log Likelihood</a></li>
<li class="chapter" data-level="6.4" data-path="tsissm.html"><a href="tsissm.html#tsissm:implementation"><i class="fa fa-check"></i><b>6.4</b> Package Implementation</a></li>
<li class="chapter" data-level="6.5" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration"><i class="fa fa-check"></i><b>6.5</b> Demonstration</a><ul>
<li class="chapter" data-level="6.5.1" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:specification"><i class="fa fa-check"></i><b>6.5.1</b> Specification</a></li>
<li class="chapter" data-level="6.5.2" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:estimation"><i class="fa fa-check"></i><b>6.5.2</b> Estimation</a></li>
<li class="chapter" data-level="6.5.3" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:prediction"><i class="fa fa-check"></i><b>6.5.3</b> Prediction</a></li>
<li class="chapter" data-level="6.5.4" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:simulation"><i class="fa fa-check"></i><b>6.5.4</b> Simulation</a></li>
<li class="chapter" data-level="6.5.5" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:filtering"><i class="fa fa-check"></i><b>6.5.5</b> Filtering</a></li>
<li class="chapter" data-level="6.5.6" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:profiling"><i class="fa fa-check"></i><b>6.5.6</b> Profiling</a></li>
<li class="chapter" data-level="6.5.7" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:backtesting"><i class="fa fa-check"></i><b>6.5.7</b> Backtesting</a></li>
<li class="chapter" data-level="6.5.8" data-path="tsissm.html"><a href="tsissm.html#tsissm:demonstration:benchmarking"><i class="fa fa-check"></i><b>6.5.8</b> Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="tsvets.html"><a href="tsvets.html"><i class="fa fa-check"></i><b>7</b> tsvets package</a><ul>
<li class="chapter" data-level="7.1" data-path="tsvets.html"><a href="tsvets.html#tsvets:introduction"><i class="fa fa-check"></i><b>7.1</b> Introduction</a></li>
<li class="chapter" data-level="7.2" data-path="tsvets.html"><a href="tsvets.html#tsvets:regressors"><i class="fa fa-check"></i><b>7.2</b> Inclusion of External Regressors</a></li>
<li class="chapter" data-level="7.3" data-path="tsvets.html"><a href="tsvets.html#tsvets:likelihood"><i class="fa fa-check"></i><b>7.3</b> Log Likelihood</a></li>
<li class="chapter" data-level="7.4" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence"><i class="fa fa-check"></i><b>7.4</b> Dependence Structure</a><ul>
<li class="chapter" data-level="7.4.1" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence:diagonal"><i class="fa fa-check"></i><b>7.4.1</b> Diagonal Covariance</a></li>
<li class="chapter" data-level="7.4.2" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence:equicorrelation"><i class="fa fa-check"></i><b>7.4.2</b> Equicorrelation</a></li>
<li class="chapter" data-level="7.4.3" data-path="tsvets.html"><a href="tsvets.html#tsvets:dependence:shrinkage"><i class="fa fa-check"></i><b>7.4.3</b> Shrinkage Covariance</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="tsvets.html"><a href="tsvets.html#tsvets:grouping"><i class="fa fa-check"></i><b>7.5</b> Grouping and Pooling</a></li>
<li class="chapter" data-level="7.6" data-path="tsvets.html"><a href="tsvets.html#tsvets:homogeneous"><i class="fa fa-check"></i><b>7.6</b> Homogeneous Coefficients and Aggregation</a></li>
<li class="chapter" data-level="7.7" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration"><i class="fa fa-check"></i><b>7.7</b> Demonstration</a><ul>
<li class="chapter" data-level="7.7.1" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:specification"><i class="fa fa-check"></i><b>7.7.1</b> Specification</a></li>
<li class="chapter" data-level="7.7.2" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example1"><i class="fa fa-check"></i><b>7.7.2</b> Example: Australian Retail Sales</a></li>
<li class="chapter" data-level="7.7.3" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example2"><i class="fa fa-check"></i><b>7.7.3</b> Example: Australian Retail Sales Grouped Dynamics</a></li>
<li class="chapter" data-level="7.7.4" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example3"><i class="fa fa-check"></i><b>7.7.4</b> Example: Australian Retail Sales Filtering</a></li>
<li class="chapter" data-level="7.7.5" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example4"><i class="fa fa-check"></i><b>7.7.5</b> Example: Australian Retail Sales Aggregation</a></li>
<li class="chapter" data-level="7.7.6" data-path="tsvets.html"><a href="tsvets.html#tsvets:demonstration:example5"><i class="fa fa-check"></i><b>7.7.6</b> Example: Price Volume Aggregation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="tsforeign.html"><a href="tsforeign.html"><i class="fa fa-check"></i><b>8</b> tsforeign package</a><ul>
<li class="chapter" data-level="8.1" data-path="tsforeign.html"><a href="tsforeign.html#tsforeign:introduction"><i class="fa fa-check"></i><b>8.1</b> Introduction</a></li>
<li class="chapter" data-level="8.2" data-path="tsforeign.html"><a href="tsforeign.html#tsforeign:arima"><i class="fa fa-check"></i><b>8.2</b> arima model</a></li>
<li class="chapter" data-level="8.3" data-path="tsforeign.html"><a href="tsforeign.html#tsforeign:bsts"><i class="fa fa-check"></i><b>8.3</b> bsts model</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="other.html"><a href="other.html"><i class="fa fa-check"></i><b>9</b> Other packages</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="_blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">A Time Series Framework</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tsvets" class="section level1">
<h1><span class="header-section-number">Chapter 7</span> tsvets package</h1>
<div id="tsvets:introduction" class="section level2">
<h2><span class="header-section-number">7.1</span> Introduction</h2>
<p>The vector exponential additive smoothing model (Vector ETS), introduced in <span class="citation">(De Silva, Hyndman, and Snyder <a href="#ref-desilva2010" role="doc-biblioref">2010</a><a href="#ref-desilva2010" role="doc-biblioref">b</a>)</span> naturally generalizes the univariate framework with a great deal of flexibility on the dynamics of the unobserved components. The dynamics of the states can be common, diagonal, grouped or fully parameterized allowing for a rich set of patterns to be captured. The <strong>tsvets</strong> package implements a more general and flexible version based on <span class="citation">(Athanasopoulos and Silva <a href="#ref-athanasopoulos2012" role="doc-biblioref">2012</a>)</span>, with methods for estimation, inference, visualization, forecasting as well as aggregation.</p>
<p>Let the vector of <em>N</em> series at time <em>t</em>, <span class="math inline">\(\bf{y}_t\)</span> be represented as a linear additive combination of their unobserved level, slope and seasonal (with frequency <em>m</em>) components, <span class="math inline">\(\bf{l}_{t-1}\)</span>, <span class="math inline">\(\bf{b}_{t-1}\)</span> and <span class="math inline">\(\bf{s}_{t-m}\)</span> respectively. Formally, the conditional mean of <span class="math inline">\(\bf{\hat y}_t\)</span> is given by:</p>
<p><span class="math display" id="eq:tsvets1">\[\begin{equation}
\bf{\hat y}_t = \bf{l}_{t - 1} + \Phi\bf{b}_{t - 1} + \bf{s}_{t - m},
\tag{7.1}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\Phi\)</span> is the <span class="math inline">\(N\times N\)</span> matrix of dampening parameters. In its reduced form, the model without seasonality is equivalent to a VARIMA(1,2,2) model, and <span class="math inline">\(\Phi\)</span> becomes the matrix of first order autoregressive coefficients.</p>
<p>The 1 step ahead forecast errors, <span class="math inline">\(\boldsymbol{\varepsilon}_t\)</span> follow a multivariate Normal distribution :</p>
<p><span class="math display" id="eq:tsvets2">\[\begin{equation}
{\boldsymbol{\varepsilon} _t} = {\bf{y}_t} - {{\bf{\hat y}}_t},\quad {\boldsymbol{\varepsilon} _t} \sim {\bf{N}}\left( {{\bf{0}},\Sigma } \right).
\tag{7.2}
\end{equation}\]</span></p>
<p>The state equations have the following dynamics:</p>
<p><span class="math display" id="eq:tsvets3">\[\begin{equation}
\begin{array}{l}
{\bf{l}_t} = {\bf{l}_{t - 1}} + \Phi {\bf{b}_{t - 1}} + {\bf{A}}{\boldsymbol{\varepsilon}_t},\\
{\bf{b}_t} = \Phi {\bf{b}_{t - 1}} + {\bf{B}}{\boldsymbol{\varepsilon}_t},\\
{\bf{s}_t} = {\bf{s}_{t - m}} + {G_1}K{\boldsymbol{\varepsilon}_t},\\
{\bf{s}_{t - m}} = {\bf{s}_{t - i}} + {G_2}K{\boldsymbol{\varepsilon}_t}
\end{array}
\tag{7.3}
\end{equation}\]</span></p>
<p>where the matrices <span class="math inline">\(\mathbf{A}\)</span>, <span class="math inline">\(\mathbf{B}\)</span> and <span class="math inline">\(\mathbf{K}\)</span> represent the adjustment of the vector components to the errors, and can be diagonal, fully parameterized or scalar (common adjustment).</p>
<p>In vector innovations state space form, the system can be written as follows:</p>
<p><span class="math display" id="eq:tsvets4">\[\begin{equation}
\begin{array}{l}
{\bf{y}_t} = H{\bf{x}_{t - 1}} + {\boldsymbol{\varepsilon}_t},\\
{\bf{x}_t} = F{\bf{x}_{t - 1}} + GA{\boldsymbol{\varepsilon}_t}
\end{array}
\tag{7.4}
\end{equation}\]</span></p>
<p>where the matrices <span class="math inline">\(H\)</span>, <span class="math inline">\(F\)</span>, <span class="math inline">\(G\)</span> and <span class="math inline">\(A\)</span> are composed as follows:</p>
<p><span class="math display" id="eq:tsvets5">\[\begin{equation}
\mathop H\limits_{\left( {m + 2} \right)N \times N}  = \left[ {\begin{array}{*{20}{c}}
{{I_N}}\\
{{I_N}}\\
{{0_{N \times N}}}\\
 \vdots \\
{{0_{N \times N}}}\\
{{I_N}}
\end{array}} \right],\quad \mathop A\limits_{\left( {m + 2} \right)N \times N}  = \left[ {\begin{array}{*{20}{c}}
{\bf{A}}\\
{\bf{B}}\\
{\bf{K}}\\
 \vdots \\
 \vdots \\
{\bf{K}}
\end{array}} \right]
\tag{7.5}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:tsvets6">\[\begin{equation}
\mathop F\limits_{\left( {m + 2} \right)N \times \left( {m + 2} \right)N}  = \left[ {\begin{array}{*{20}{c}}
{{I_N}}&amp;{{I_N}}&amp;{{0_{N \times mN}}}\\
{{0_{N \times N}}}&amp;{{\Phi _N}}&amp;{{0_{N \times mN}}}\\
{{0_{mN \times N}}}&amp;{{0_{mN \times N}}}&amp;{\tilde F \otimes {I_N}}
\end{array}} \right],\mathop {\tilde F}\limits_{m \times m}  = \left[ {\begin{array}{*{20}{c}}
0&amp;0&amp;0&amp; \cdots &amp;0&amp;1\\
1&amp;0&amp;0&amp; \cdots &amp;0&amp;0\\
0&amp;1&amp;0&amp; \cdots &amp;0&amp;0\\
 \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots &amp; \vdots \\
0&amp;0&amp;0&amp; \cdots &amp;1&amp;0
\end{array}} \right]
\tag{7.6}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:tsvets7">\[\begin{equation}
\mathop G\limits_{\left( {m + 2} \right)N \times \left( {m + 2} \right)N}  = \left[ {\begin{array}{*{20}{c}}
{{I_N}}&amp;{{0_{N \times N}}}&amp;{{0_{N \times mN}}}\\
{{0_{N \times N}}}&amp;{{I_N}}&amp;{{0_{N \times mN}}}\\
{{0_{mN \times N}}}&amp;{{0_{mN \times N}}}&amp;{\tilde G \otimes {I_N}}
\end{array}} \right],\quad \mathop {\tilde G}\limits_{m \times m}  = \left[ {\begin{array}{*{20}{c}}
{\frac{{m - 1}}{m}}&amp;0&amp; \cdots &amp;0&amp;0\\
0&amp;{ - \frac{1}{m}}&amp; \cdots &amp;0&amp;0\\
0&amp;0&amp;{ - \frac{1}{m}}&amp;0&amp;0\\
 \vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; \vdots \\
0&amp;0&amp;0&amp; \cdots &amp;{ - \frac{1}{m}}
\end{array}} \right]
\tag{7.7}
\end{equation}\]</span></p>
<p><span class="math display" id="eq:tsvets8">\[\begin{equation}
\mathop {{\bf{x}_t}}\limits_{\left( {m + 2} \right)N \times N}  = \left[ {\begin{array}{*{20}{c}}
{{\bf{l}_t}}\\
{{\bf{b}_t}}\\
{{\bf{s}_t}}\\
 \vdots \\
{{\bf{s}_{t - m + 2}}}\\
{{\bf{s}_{t - m + 1}}}
\end{array}} \right]
\tag{7.8}
\end{equation}\]</span></p>
<p>The values in the seasonal matrix <span class="math inline">\(\tilde G\)</span> represent normalization terms which ensure that the seasonal component adds to zero throughout the updating process without becoming contaminated by the level component.</p>
</div>
<div id="tsvets:regressors" class="section level2">
<h2><span class="header-section-number">7.2</span> Inclusion of External Regressors</h2>
<p>We augment the model by the ability to include external regressors (<span class="math inline">\(z_t\)</span>) such that:</p>
<p><span class="math display" id="eq:tsvets9">\[\begin{equation}
\begin{array}{l}
{\bf{y}_t} = H{\bf{x}_{t - 1}} + \mathbf{W}\bf{z}_t + {\boldsymbol{\varepsilon}_t},\\
{\bf{x}_t} = F{\bf{x}_{t - 1}} + GA{\boldsymbol{\varepsilon}_t}
\end{array}
\tag{7.9}
\end{equation}\]</span></p>
<p>where the <span class="math inline">\(W\)</span> is the matrix of coefficients which is time invariant. The <em>xreg_include</em> argument in the <strong>vets_modelspec</strong> function is a design matrix which allows one to define which coefficients should be set to zero, which should be estimated individually as well as which should be pooled (see the documentation for more details). The index on <span class="math inline">\(\bf{z}\)</span> is <span class="math inline">\(t\)</span> and not <span class="math inline">\(t-1\)</span> and it is left to the user to pre-lag any regressors passed to the function. At present, pooling is global and we do not allow group based pooling. However, this could be achieved by careful replication of the regressor, setting betas to zero for all groups minus the group where pooling is required. This may change in the future is we decide to allow group based pooling.</p>
</div>
<div id="tsvets:likelihood" class="section level2">
<h2><span class="header-section-number">7.3</span> Log Likelihood</h2>
<p>The log likelihood (<span class="math inline">\(L\)</span>) of the model follows from the assumption that the innovations <span class="math inline">\(\boldsymbol{\varepsilon_t}\sim N\left(\bf{0}, \Sigma\right)\)</span>, leading to the following function:</p>
<p><span class="math display" id="eq:tsvets10">\[\begin{equation}
L\left(\boldsymbol{\theta}  \right) = \frac{T}{2}\left( {N\log \left( {2\pi } \right) + N\log \left| \Sigma  \right|} \right) - \frac{1}{2}\sum\limits_{t = 1}^T {\boldsymbol{\varepsilon_t}{\Sigma ^{ - 1}}\boldsymbol{\varepsilon_t}},
\tag{7.10}
\end{equation}\]</span></p>
<p>where <span class="math inline">\(\boldsymbol{\theta}\)</span> is the vector of parameters being optimized. We also concentrate out the parameters of the covariance matrix by using its ML estimator</p>
<p><span class="math display" id="eq:tsvets11">\[\begin{equation}
\hat \Sigma  = \frac{1}{T}\sum\limits_{t = 1}^T {{\boldsymbol{\varepsilon}_t}{{\boldsymbol{\varepsilon}&#39;}_t}}.
\tag{7.11}
\end{equation}\]</span></p>
<p>Therefore, the vector ETS log likelihood is proportional to</p>
<p><span class="math display" id="eq:tsvets12">\[\begin{equation}
L\left(\boldsymbol{\theta}  \right) \propto \sum\limits_{t = 1}^T {{{\boldsymbol{\varepsilon}&#39;}_t}{{\hat \Sigma }^{ - 1}}{\boldsymbol{\varepsilon}_t}},
\tag{7.12}
\end{equation}\]</span></p>
<p>which requires looping through each <span class="math inline">\(t\)</span> to calculate the quadratic form which is expensive. Instead, we can make use of the following relationship, assuming positive or positive-semi-definite <span class="math inline">\(\hat \Sigma\)</span>, <span class="math inline">\({\hat\Sigma ^{ - 1}} = Q\Lambda^{-1} Q&#39;\)</span><a href="#fn17" class="footnote-ref" id="fnref17"><sup>17</sup></a>, and thus <span class="math inline">\({\varepsilon _t} = Q{\bf{u}_t}\)</span>, where <span class="math inline">\(\bf{u}_t\)</span> are the projections onto the eigenvectors <span class="math inline">\(Q\)</span>. The negative of the log likelihood can be represented as:</p>
<p><span class="math display" id="eq:tsvets13">\[\begin{equation}
L\left( \boldsymbol{\theta}  \right) = \frac{1}{2}T\left( {N\log 2\pi  - \log \left| {\hat \Sigma } \right|} \right) + \frac{1}{2}{{{\bf{1&#39;}}}_T}\left( {{{\left( {\varepsilon Q} \right)}^2}\frac{1}{\lambda }} \right)
\tag{7.13}
\end{equation}\]</span></p>
<p>where we have used the relation <span class="math inline">\(Q^{-1} = Q&#39;\)</span> due to <span class="math inline">\(\hat{\Sigma}\)</span> being symmetric.</p>
<p>Additionally, we constrain the N+1 largest eigenvalues (<span class="math inline">\(\lambda_s\)</span>) to be less than 1 to ensure invertibility of the system, such that</p>
<p><span class="math display" id="eq:tsvets15">\[\begin{equation}
{\lambda _s}\left( D \right) &lt; 1,D = F - GAH.
\tag{7.14}
\end{equation}\]</span></p>
<p>This is added as a soft barrier constraint. The diagonal elements of the level, slope, dampening and seasonal matrices are bounded between 0 and 1, while the off diagonal elements are allowed to vary between -1 and 1.<a href="#fn18" class="footnote-ref" id="fnref18"><sup>18</sup></a></p>
<p>Finally, the initial seed values for each of the states are approximated using the heuristic approach from the univariate ETS model as described in Section <a href="tsets.html#tsets:implementation:initialization">5.5.2</a>.</p>
</div>
<div id="tsvets:dependence" class="section level2">
<h2><span class="header-section-number">7.4</span> Dependence Structure</h2>
<p>While Equation <a href="tsissm.html#eq:tsissm10">(6.10)</a> assumes a full covariance matrix, allowing contemporaneous associations among the residuals, we also offer 3 additional estimators for the dependence structure: diagonal covariance, equicorrelation and shrinkage covariance based on the estimator of <span class="citation">(Ledoit and Wolf <a href="#ref-ledoit2004well" role="doc-biblioref">2004</a>)</span>.</p>
<div id="tsvets:dependence:diagonal" class="section level3">
<h3><span class="header-section-number">7.4.1</span> Diagonal Covariance</h3>
<p>The diagonal covariance matrix is the one used by <span class="citation">(Athanasopoulos and Silva <a href="#ref-athanasopoulos2012" role="doc-biblioref">2012</a>)</span>, and leads to the fastest estimation. In this case, the log likelihood is greatly simplified and equal to</p>
<p><span class="math display" id="eq:tsvets16">\[\begin{equation}
\frac{T}{2}\left( {N\log \left( {2\pi } \right) + N\log \left| \Sigma  \right|} \right) - \frac{1}{2}\sum\limits_{t = 1}^T {\sum\limits_{i = 1}^N {\varepsilon _{it}^2/\sigma _i^2} }.
\tag{7.15}
\end{equation}\]</span></p>
</div>
<div id="tsvets:dependence:equicorrelation" class="section level3">
<h3><span class="header-section-number">7.4.2</span> Equicorrelation</h3>
<p>The equicorrelation covariance assumes that the correlation across all series is set to some common value <span class="math inline">\(\rho\)</span>. The correlation matrix <span class="math inline">\(\bf{R}\)</span> can be calculated as</p>
<p><span class="math display" id="eq:tsvets17">\[\begin{equation}
{\bf{R}} = \rho {\bf{11&#39;}} + \left( {1 - \rho } \right){\bf{I}},
\tag{7.16}
\end{equation}\]</span></p>
<p>which is guaranteed to be positive definite as long as <span class="math inline">\(-\frac{1}{{N - 1}}&lt;\rho&lt; 1\)</span>. The covariance is then equal to :</p>
<p><span class="math display" id="eq:tsvets18">\[\begin{equation}
{\Sigma} = {\bf{DRD&#39;}}
\tag{7.17}
\end{equation}\]</span></p>
<p>where <span class="math inline">\({\bf{D}} = diag\left( {{\hat \sigma _1},\dots,{\hat \sigma _n}} \right)\)</span>. Some of the advantages of assuming equicorrelation are discussed in <span class="citation">(Clements, Scott, and Silvennoinen <a href="#ref-clements2015benefits" role="doc-biblioref">2015</a>)</span>.</p>
</div>
<div id="tsvets:dependence:shrinkage" class="section level3">
<h3><span class="header-section-number">7.4.3</span> Shrinkage Covariance</h3>
<p>The shrinkage estimator of <span class="citation">(Ledoit and Wolf <a href="#ref-ledoit2004well" role="doc-biblioref">2004</a>)</span> follows from the observation that the eigenvalues of the estimations correlations tend to be more dispersed than the eigenvalues of the true data generating process. The shrinkage estimator of the covariance is based on a convex combination of the sample covariance <span class="math inline">\(\hat\Sigma\)</span> and a target covariance set to a multiple of the identity matrix. It is this combination weight <span class="math inline">\(\rho\)</span> which we estimate in the case of the shrinkage estimator</p>
<p><span class="math display" id="eq:tsvets18">\[\begin{equation}
{\Sigma} = \left( {1 - \rho } \right)\Sigma  + \frac{\rho }{n}tr\left( \Sigma  \right){\bf{I}}.
\tag{7.17}
\end{equation}\]</span></p>
</div>
</div>
<div id="tsvets:grouping" class="section level2">
<h2><span class="header-section-number">7.5</span> Grouping and Pooling</h2>
<p>The <strong>tsvets</strong> package allows both global pooling of state component coefficients as well as group-wise pooling. For instance, if we had a large dimensional system composed of series which have some common grouping structure (e.g. geographical, feature or statistical based), we could impose that these groups have common dynamics for some or all of the components. We provide an example of this in the demonstration section.</p>
</div>
<div id="tsvets:homogeneous" class="section level2">
<h2><span class="header-section-number">7.6</span> Homogeneous Coefficients and Aggregation</h2>
<p>When a model is estimated with all components pooled (i.e. common coefficients), then we can aggregate the model to obtain an aggregated representation in closed form, following Section 17.1.2 of <span class="citation">(R. Hyndman et al. <a href="#ref-hyndman2008" role="doc-biblioref">2008</a>)</span>. When this is not the case, we can still obtain an aggregated series from the estimation and prediction objects. This functionality is implemented via the <em>tsaggregate</em> method and we provide an example in the demonstration section.</p>
</div>
<div id="tsvets:demonstration" class="section level2">
<h2><span class="header-section-number">7.7</span> Demonstration</h2>
<div id="tsvets:demonstration:specification" class="section level3">
<h3><span class="header-section-number">7.7.1</span> Specification</h3>
<p>The specification function defines the entry point for setting up a vets model:</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="tsvets.html#cb108-1"></a><span class="kw">suppressWarnings</span>(<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(tsvets)))</span>
<span id="cb108-2"><a href="tsvets.html#cb108-2"></a><span class="kw">args</span>(vets_modelspec)</span></code></pre></div>
<pre><code>## function (y, level = c(&quot;constant&quot;, &quot;diagonal&quot;, &quot;common&quot;, &quot;full&quot;, 
##     &quot;grouped&quot;), slope = c(&quot;none&quot;, &quot;constant&quot;, &quot;common&quot;, &quot;diagonal&quot;, 
##     &quot;full&quot;, &quot;grouped&quot;), damped = c(&quot;none&quot;, &quot;common&quot;, &quot;diagonal&quot;, 
##     &quot;full&quot;, &quot;grouped&quot;), seasonal = c(&quot;none&quot;, &quot;common&quot;, &quot;diagonal&quot;, 
##     &quot;full&quot;, &quot;grouped&quot;), group = NULL, xreg = NULL, xreg_include = NULL, 
##     frequency = 1, lambda = NULL, lambda_lower = 0, lambda_upper = 1.5, 
##     dependence = c(&quot;diagonal&quot;, &quot;full&quot;, &quot;equicorrelation&quot;, &quot;shrinkage&quot;), 
##     cores = 1) 
## NULL</code></pre>
<p>The specification has options for how the components of level, slope, dampening, seasonality are structured as well as the type of dependence to use. We also allow multicore processing since we require the initial state vectors to be calculated through calls to the <strong>tsets</strong> package, which can be done in parallel. The <strong>lambda</strong> argument can be set either to NA, in which case the multivariate version of the Box Cox transformation is used which targets a transformation to multivariate normality based on <span class="citation">(Velilla <a href="#ref-velilla1993note" role="doc-biblioref">1993</a>)</span> using the <strong>powerTransform</strong> function from the <strong>car</strong> package of <span class="citation">(Fox, Weisberg, and Price <a href="#ref-R-car" role="doc-biblioref">2020</a>)</span>, a vector of length equal to the number of series of a single number to apply to all series, and NULL in which case no transformation is performed.</p>
<p>The next sections provide fully worked examples with methods showcasing the functionality of the package under different assumptions.</p>
</div>
<div id="tsvets:demonstration:example1" class="section level3">
<h3><span class="header-section-number">7.7.2</span> Example: Australian Retail Sales</h3>
<p>We use a subset of the Australian retail dataset from package <strong>tsdatasets</strong> representing the monthly retail turnover in $Million AUD across different regions for the news vendor category, with common level, constant slope and diagonal seasonal and dependence structure.</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="tsvets.html#cb110-1"></a><span class="kw">suppressWarnings</span>(<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(tsvets)))</span>
<span id="cb110-2"><a href="tsvets.html#cb110-2"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsmethods))</span>
<span id="cb110-3"><a href="tsvets.html#cb110-3"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsaux))</span>
<span id="cb110-4"><a href="tsvets.html#cb110-4"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(xts))</span>
<span id="cb110-5"><a href="tsvets.html#cb110-5"></a><span class="kw">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb110-6"><a href="tsvets.html#cb110-6"></a>y &lt;-<span class="st"> </span><span class="kw">na.omit</span>(austretail[,<span class="kw">grepl</span>(<span class="st">&quot;NEWS&quot;</span>, <span class="kw">colnames</span>(austretail))]) </span>
<span id="cb110-7"><a href="tsvets.html#cb110-7"></a>spec &lt;-<span class="st"> </span><span class="kw">vets_modelspec</span>(y, <span class="dt">level =</span> <span class="st">&quot;common&quot;</span>, <span class="dt">slope =</span> <span class="st">&quot;constant&quot;</span>, <span class="dt">damped =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">seasonal =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="dt">lambda =</span> <span class="ot">NA</span>, <span class="dt">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="dt">frequency =</span> <span class="dv">12</span>, <span class="dt">cores =</span> <span class="dv">3</span>)</span>
<span id="cb110-8"><a href="tsvets.html#cb110-8"></a>mod &lt;-<span class="st"> </span><span class="kw">estimate</span>(spec, <span class="dt">solver =</span> <span class="st">&quot;solnp&quot;</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>The joint estimation of the 8 series takes about 1.316257 seconds. The summary object prints the full matrices for each component using the Matrix package of <span class="citation">(Bates and Maechler <a href="#ref-R-Matrix" role="doc-biblioref">2019</a>)</span>. The summary method also take an optional <strong>weights</strong> argument which is used to calculate the weighted Accuracy Criteria, and when this is NULL, an equal weight vector is used instead (and hence equivalent to the Mean Criteria).</p>
<p>Similar to other packages, there is a diagnostics method <strong>tsdiagnose</strong> which prints the eiganvalues of the D matrix as well as the output from a multivariate Normality Test and Multivariate Outliers based on the <strong>mvn</strong> function of the <strong>MVN</strong> package of <span class="citation">(Korkmaz, Goksuluk, and Zararsiz <a href="#ref-R-MVN" role="doc-biblioref">2019</a>)</span>.</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="tsvets.html#cb111-1"></a><span class="kw">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : constant 
## Seasonal : diagonal 
## Dependence : diagonal 
## No. Series : 8 
## No. TimePoints : 369 
## 
## Parameter Matrices
## 
## Level Matrix
## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]      [,2]      [,3]      [,4]      [,5]      [,6]      [,7]     
## [1,] 0.7228698         .         .         .         .         .         .
## [2,]         . 0.7228698         .         .         .         .         .
## [3,]         .         . 0.7228698         .         .         .         .
## [4,]         .         .         . 0.7228698         .         .         .
## [5,]         .         .         .         . 0.7228698         .         .
## [6,]         .         .         .         .         . 0.7228698         .
## [7,]         .         .         .         .         .         . 0.7228698
## [8,]         .         .         .         .         .         .         .
##      [,8]     
## [1,]         .
## [2,]         .
## [3,]         .
## [4,]         .
## [5,]         .
## [6,]         .
## [7,]         .
## [8,] 0.7228698
## 
## Slope Matrix
## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1] [,2] [,3] [,4] [,5] [,6] [,7] [,8]
## [1,]    0    .    .    .    .    .    .    .
## [2,]    .    0    .    .    .    .    .    .
## [3,]    .    .    0    .    .    .    .    .
## [4,]    .    .    .    0    .    .    .    .
## [5,]    .    .    .    .    0    .    .    .
## [6,]    .    .    .    .    .    0    .    .
## [7,]    .    .    .    .    .    .    0    .
## [8,]    .    .    .    .    .    .    .    0
## 
## Seasonal Matrix
## 8 x 8 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]      [,2]         [,3]         [,4]         [,5]         [,6]       
## [1,] 0.2856528            .            .            .            .           .
## [2,]         . 2.394893e-09            .            .            .           .
## [3,]         .            . 3.847806e-09            .            .           .
## [4,]         .            .            . 5.733773e-09            .           .
## [5,]         .            .            .            . 3.585966e-09           .
## [6,]         .            .            .            .            . 6.53269e-09
## [7,]         .            .            .            .            .           .
## [8,]         .            .            .            .            .           .
##      [,7]      [,8]        
## [1,]         .            .
## [2,]         .            .
## [3,]         .            .
## [4,]         .            .
## [5,]         .            .
## [6,]         .            .
## [7,] 0.1511017            .
## [8,]         . 2.546543e-09
## 
## Correlation Matrix
## 8 x 8 Matrix of class &quot;dsyMatrix&quot;
##             ACF.NEWS   NSW.NEWS    NT.NEWS     Q.NEWS    SA.NEWS        T.NEWS
## ACF.NEWS  1.00000000 0.08053228 0.03288147 0.17038002 0.05281511  0.0949562036
## NSW.NEWS  0.08053228 1.00000000 0.20606452 0.15796192 0.11770804  0.1722075892
## NT.NEWS   0.03288147 0.20606452 1.00000000 0.11509632 0.09843775  0.1271500930
## Q.NEWS    0.17038002 0.15796192 0.11509632 1.00000000 0.13848200  0.0596225947
## SA.NEWS   0.05281511 0.11770804 0.09843775 0.13848200 1.00000000  0.0589267343
## T.NEWS    0.09495620 0.17220759 0.12715009 0.05962259 0.05892673  1.0000000000
## V.NEWS    0.20519206 0.23060284 0.11493411 0.10415289 0.14049629  0.0727757610
## WA.NEWS  -0.02841206 0.20572327 0.19391118 0.17141803 0.12027858 -0.0006816997
##              V.NEWS       WA.NEWS
## ACF.NEWS 0.20519206 -0.0284120588
## NSW.NEWS 0.23060284  0.2057232690
## NT.NEWS  0.11493411  0.1939111809
## Q.NEWS   0.10415289  0.1714180312
## SA.NEWS  0.14049629  0.1202785772
## T.NEWS   0.07277576 -0.0006816997
## V.NEWS   1.00000000  0.0313987574
## WA.NEWS  0.03139876  1.0000000000
## 
## Information Criteria
##  AIC     BIC     AICc   
##  1278.63 2003.45 1289.06
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0618   0.0618
## MSLRE 0.0068   0.0068</code></pre>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="tsvets.html#cb113-1"></a><span class="kw">tsdiagnose</span>(mod)</span></code></pre></div>
<pre><code>## Real Eigenvalues (D): 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 0.866 0.866 0.866 0.866 0.866 0.866 0.866 0.866 0.866 0.866 0.866 0.866 0.5 0.5 0.5 0.5 0 0 0.5 0.5 0 0 0.5 0.5 0.5 0.5 0.5 0.5 0.866 0.866 1 0.866 0.866 1 0 0 0 0 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.5 0.866 0.866 1 0.866 0.866 1 0 0 0 0 0.5 0.5 0.866 0.866 1 0.5 0.5 0.866 0.866 1 0.867 0.867 0.869 0.869 0.505 0.505 0.01 0.01 0.511 0.511 0.484 0.484 0.846 0.846 0.978 0.023 0.023 0.465 0.465 0.822 0.822 0.952 0.277 0.277 0.277 0.277 0.277 0.277 0.163 0.021</code></pre>
<p><img src="tsmodels_files/figure-html/vets_example1_2-1.png" width="672" /></p>
<pre><code>## 
## Multivariate Normality Tests
##             Test        E df      p value MVN
## 1 Doornik-Hansen 216.8128 16 3.099929e-37  NO
## 
## Univariate Normality Tests
##              Test  Variable Statistic   p value Normality
## 1 Shapiro-Francia ACF.NEWS     0.9850  0.0011      NO    
## 2 Shapiro-Francia NSW.NEWS     0.9943  0.1602      YES   
## 3 Shapiro-Francia  NT.NEWS     0.9720  &lt;0.001      NO    
## 4 Shapiro-Francia  Q.NEWS      0.9860  0.0018      NO    
## 5 Shapiro-Francia  SA.NEWS     0.9845   9e-04      NO    
## 6 Shapiro-Francia  T.NEWS      0.9867  0.0026      NO    
## 7 Shapiro-Francia  V.NEWS      0.9688  &lt;0.001      NO    
## 8 Shapiro-Francia  WA.NEWS     0.9738  &lt;0.001      NO    
## 
## Multivariate Outliers (Mahalanobis Distance)
##     Observation Mahalanobis Distance Outlier
## 21   1989-12-31               25.081    TRUE
## 24   1990-03-31               24.942    TRUE
## 33   1990-12-31               19.528    TRUE
## 54   1992-09-30               23.034    TRUE
## 63   1993-06-30               21.246    TRUE
## 66   1993-09-30               20.317    TRUE
## 69   1993-12-31               58.753    TRUE
## 72   1994-03-31               31.115    TRUE
## 105  1996-12-31               47.116    TRUE
## 106  1997-01-31               24.857    TRUE
## 121  1998-04-30               37.653    TRUE
## 124  1998-07-31               19.277    TRUE
## 142  2000-01-31               40.444    TRUE
## 148  2000-07-31               19.625    TRUE
## 157  2001-04-30               26.903    TRUE
## 166  2002-01-31               26.156    TRUE
## 172  2002-07-31               46.330    TRUE
## 184  2003-07-31               28.908    TRUE
## 226  2007-01-31               23.302    TRUE
## 235  2007-10-31               79.396    TRUE
## 238  2008-01-31               22.707    TRUE
## 241  2008-04-30               31.689    TRUE
## 251  2009-02-28               22.112    TRUE
## 256  2009-07-31               23.650    TRUE
## 259  2009-10-31               19.600    TRUE
## 261  2009-12-31               20.838    TRUE
## 262  2010-01-31               67.995    TRUE
## 263  2010-02-28               48.985    TRUE
## 265  2010-04-30               30.044    TRUE
## 268  2010-07-31               22.728    TRUE
## 274  2011-01-31               90.181    TRUE
## 285  2011-12-31               22.557    TRUE
## 286  2012-01-31               49.672    TRUE
## 287  2012-02-29               19.881    TRUE
## 295  2012-10-31               29.557    TRUE
## 301  2013-04-30               51.556    TRUE
## 302  2013-05-31               19.664    TRUE
## 307  2013-10-31               19.951    TRUE
## 309  2013-12-31               28.466    TRUE
## 310  2014-01-31               38.202    TRUE</code></pre>
<p>Additional methods are similar to what is available in other packages.</p>
<p>Coefficients:</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="tsvets.html#cb116-1"></a><span class="kw">coef</span>(mod)</span></code></pre></div>
<pre><code>##      Level[Common] Seasonal[ACF.NEWS] Seasonal[NSW.NEWS]  Seasonal[NT.NEWS] 
##       7.228698e-01       2.856528e-01       2.394893e-09       3.847806e-09 
##   Seasonal[Q.NEWS]  Seasonal[SA.NEWS]   Seasonal[T.NEWS]   Seasonal[V.NEWS] 
##       5.733773e-09       3.585966e-09       6.532690e-09       1.511017e-01 
##  Seasonal[WA.NEWS] 
##       2.546543e-09</code></pre>
<p>Loglikelihood and AIC:</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="tsvets.html#cb118-1"></a><span class="kw">logLik</span>(mod)</span></code></pre></div>
<pre><code>## &#39;log Lik.&#39; 1036.628 (df=121)</code></pre>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="tsvets.html#cb120-1"></a><span class="kw">AIC</span>(mod)</span></code></pre></div>
<pre><code>## [1] 1278.628</code></pre>
<p>Performance metrics with optional weights option:</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="tsvets.html#cb122-1"></a><span class="kw">tsmetrics</span>(mod, <span class="dt">weights =</span> <span class="kw">runif</span>(<span class="dv">8</span>))</span></code></pre></div>
<pre><code>##      N no_pars   LogLik      AIC      BIC     AICc       MAPE       MSLRE
## 1 2952     121 1036.628 1278.628 2003.447 1289.061 0.06177398 0.006824942
##         WAPE      WSLRE
## 1 0.06240583 0.00688782</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="tsvets.html#cb124-1"></a><span class="kw">tscor</span>(mod)</span></code></pre></div>
<pre><code>## 8 x 8 Matrix of class &quot;dsyMatrix&quot;
##             ACF.NEWS   NSW.NEWS    NT.NEWS     Q.NEWS    SA.NEWS        T.NEWS
## ACF.NEWS  1.00000000 0.08053228 0.03288147 0.17038002 0.05281511  0.0949562036
## NSW.NEWS  0.08053228 1.00000000 0.20606452 0.15796192 0.11770804  0.1722075892
## NT.NEWS   0.03288147 0.20606452 1.00000000 0.11509632 0.09843775  0.1271500930
## Q.NEWS    0.17038002 0.15796192 0.11509632 1.00000000 0.13848200  0.0596225947
## SA.NEWS   0.05281511 0.11770804 0.09843775 0.13848200 1.00000000  0.0589267343
## T.NEWS    0.09495620 0.17220759 0.12715009 0.05962259 0.05892673  1.0000000000
## V.NEWS    0.20519206 0.23060284 0.11493411 0.10415289 0.14049629  0.0727757610
## WA.NEWS  -0.02841206 0.20572327 0.19391118 0.17141803 0.12027858 -0.0006816997
##              V.NEWS       WA.NEWS
## ACF.NEWS 0.20519206 -0.0284120588
## NSW.NEWS 0.23060284  0.2057232690
## NT.NEWS  0.11493411  0.1939111809
## Q.NEWS   0.10415289  0.1714180312
## SA.NEWS  0.14049629  0.1202785772
## T.NEWS   0.07277576 -0.0006816997
## V.NEWS   1.00000000  0.0313987574
## WA.NEWS  0.03139876  1.0000000000</code></pre>
<p>Correlation and Covariance matrices:</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="tsvets.html#cb126-1"></a><span class="kw">tscov</span>(mod)</span></code></pre></div>
<pre><code>## 8 x 8 Matrix of class &quot;dsyMatrix&quot;
##               ACF.NEWS     NSW.NEWS      NT.NEWS       Q.NEWS      SA.NEWS
## ACF.NEWS  0.0115176906 0.0005204062 0.0006261186 0.0011599566 0.0004533611
## NSW.NEWS  0.0005204062 0.0036255980 0.0022014849 0.0006033685 0.0005668906
## NT.NEWS   0.0006261186 0.0022014849 0.0314807680 0.0012954614 0.0013969719
## Q.NEWS    0.0011599566 0.0006033685 0.0012954614 0.0040242112 0.0007026467
## SA.NEWS   0.0004533611 0.0005668906 0.0013969719 0.0007026467 0.0063974462
## T.NEWS    0.0026750627 0.0027218866 0.0059219845 0.0009928398 0.0012372106
## V.NEWS    0.0016124599 0.0010167171 0.0014931975 0.0004837905 0.0008228370
## WA.NEWS  -0.0012068174 0.0049026332 0.0136170073 0.0043038095 0.0038075688
##                 T.NEWS       V.NEWS       WA.NEWS
## ACF.NEWS  2.675063e-03 0.0016124599 -1.206817e-03
## NSW.NEWS  2.721887e-03 0.0010167171  4.902633e-03
## NT.NEWS   5.921984e-03 0.0014931975  1.361701e-02
## Q.NEWS    9.928398e-04 0.0004837905  4.303810e-03
## SA.NEWS   1.237211e-03 0.0008228370  3.807569e-03
## T.NEWS    6.890581e-02 0.0013988152 -7.082346e-05
## V.NEWS    1.398815e-03 0.0053615617  9.099432e-04
## WA.NEWS  -7.082346e-05 0.0009099432  1.566435e-01</code></pre>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="tsvets.html#cb128-1"></a><span class="kw">tscor</span>(mod)</span></code></pre></div>
<pre><code>## 8 x 8 Matrix of class &quot;dsyMatrix&quot;
##             ACF.NEWS   NSW.NEWS    NT.NEWS     Q.NEWS    SA.NEWS        T.NEWS
## ACF.NEWS  1.00000000 0.08053228 0.03288147 0.17038002 0.05281511  0.0949562036
## NSW.NEWS  0.08053228 1.00000000 0.20606452 0.15796192 0.11770804  0.1722075892
## NT.NEWS   0.03288147 0.20606452 1.00000000 0.11509632 0.09843775  0.1271500930
## Q.NEWS    0.17038002 0.15796192 0.11509632 1.00000000 0.13848200  0.0596225947
## SA.NEWS   0.05281511 0.11770804 0.09843775 0.13848200 1.00000000  0.0589267343
## T.NEWS    0.09495620 0.17220759 0.12715009 0.05962259 0.05892673  1.0000000000
## V.NEWS    0.20519206 0.23060284 0.11493411 0.10415289 0.14049629  0.0727757610
## WA.NEWS  -0.02841206 0.20572327 0.19391118 0.17141803 0.12027858 -0.0006816997
##              V.NEWS       WA.NEWS
## ACF.NEWS 0.20519206 -0.0284120588
## NSW.NEWS 0.23060284  0.2057232690
## NT.NEWS  0.11493411  0.1939111809
## Q.NEWS   0.10415289  0.1714180312
## SA.NEWS  0.14049629  0.1202785772
## T.NEWS   0.07277576 -0.0006816997
## V.NEWS   1.00000000  0.0313987574
## WA.NEWS  0.03139876  1.0000000000</code></pre>
<p>Note that, even though we impose a diagonal covariance matrix structure, we still return the full covariance matrix in <strong>tscov</strong>.</p>
<p>Fitted and residuals:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb130-1"><a href="tsvets.html#cb130-1"></a><span class="kw">head</span>(<span class="kw">fitted</span>(mod)[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            ACF.NEWS NSW.NEWS  NT.NEWS   Q.NEWS
## 1988-04-30 5.083114 73.64484 1.826404 32.42632
## 1988-05-31 5.676503 77.54206 1.989451 33.63409
## 1988-06-30 5.075911 74.71801 2.035402 34.26673
## 1988-07-31 4.934337 80.55046 2.505502 36.89036</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="tsvets.html#cb132-1"></a><span class="kw">head</span>(<span class="kw">residuals</span>(mod)[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##               ACF.NEWS   NSW.NEWS     NT.NEWS     Q.NEWS
## 1988-04-30  0.01688627 -0.6448413 -0.02640414 -0.6263172
## 1988-05-31 -0.07650333  2.7579415  0.01054904  3.0659131
## 1988-06-30 -0.07591079  0.5819950  0.36459759  0.4332681
## 1988-07-31 -0.03433663 -6.3504562 -0.10550187  2.2096412</code></pre>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="tsvets.html#cb134-1"></a><span class="kw">head</span>(<span class="kw">residuals</span>(mod, <span class="dt">raw =</span> <span class="ot">TRUE</span>)[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##                ACF.NEWS     NSW.NEWS     NT.NEWS      Q.NEWS
## 1988-04-30  0.003685292 -0.008794656 -0.02038207 -0.01950406
## 1988-05-31 -0.015177478  0.034949141  0.00781199  0.08723671
## 1988-06-30 -0.016731980  0.007759041  0.25801749  0.01256472
## 1988-07-31 -0.007741982 -0.082119623 -0.07141321  0.05817223</code></pre>
<p>where argument <strong>raw</strong> denotes the non backtransformed residuals (if a Box Cox calculation was used).</p>
<p>States decomposition:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="tsvets.html#cb136-1"></a>tsx &lt;-<span class="st"> </span><span class="kw">tsdecompose</span>(mod)</span>
<span id="cb136-2"><a href="tsvets.html#cb136-2"></a><span class="kw">head</span>(tsx<span class="op">$</span>Level[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            Level[ACF.NEWS] Level[NSW.NEWS] Level[NT.NEWS] Level[Q.NEWS]
## 1988-04-30        1.788055        4.364053      0.8567776      3.546527
## 1988-05-31        1.776978        4.389549      0.8604629      3.610767
## 1988-06-30        1.764778        4.395390      1.0450142      3.621028
## 1988-07-31        1.759076        4.336260      0.9914300      3.664259</code></pre>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb138-1"><a href="tsvets.html#cb138-1"></a><span class="kw">head</span>(tsx<span class="op">$</span>Slope[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            Slope[ACF.NEWS] Slope[NSW.NEWS] Slope[NT.NEWS] Slope[Q.NEWS]
## 1988-04-30   -0.0001052366    0.0002321543   -0.001961735   0.001179104
## 1988-05-31   -0.0001052366    0.0002321543   -0.001961735   0.001179104
## 1988-06-30   -0.0001052366    0.0002321543   -0.001961735   0.001179104
## 1988-07-31   -0.0001052366    0.0002321543   -0.001961735   0.001179104</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="tsvets.html#cb140-1"></a><span class="kw">head</span>(tsx<span class="op">$</span>Seasonal[,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>], <span class="dv">4</span>)</span></code></pre></div>
<pre><code>##            Seasonal[ACF.NEWS] Seasonal[NSW.NEWS] Seasonal[NT.NEWS]
## 1988-04-30        0.049800534       -0.013464584       -0.01415702
## 1988-05-31       -0.063813013       -0.076059803        0.01605647
## 1988-06-30       -0.083010746       -0.006738054        0.16093585
## 1988-07-31       -0.003459199        0.020157292        0.13897908
##            Seasonal[Q.NEWS]
## 1988-04-30     -0.032165866
## 1988-05-31     -0.077770829
## 1988-06-30     -0.014257319
## 1988-07-31      0.009366027</code></pre>
<p>Plot methods exist outputing the fitted values, the states and the residuals, with an argument for the series to output, with a maximum number per call of 10 series:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb142-1"><a href="tsvets.html#cb142-1"></a><span class="kw">plot</span>(mod)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-14-1.png" width="768" /></p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="tsvets.html#cb143-1"></a><span class="kw">plot</span>(mod, <span class="dt">type =</span> <span class="st">&quot;states&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-14-2.png" width="768" /></p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="tsvets.html#cb144-1"></a><span class="kw">plot</span>(mod, <span class="dt">type =</span> <span class="st">&quot;residuals&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-14-3.png" width="768" /></p>
<p>The <strong>predict</strong> function will output a list which includes data.table of each series’ prediction object and state decomposition:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="tsvets.html#cb145-1"></a>p &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">h =</span> <span class="dv">12</span>)</span>
<span id="cb145-2"><a href="tsvets.html#cb145-2"></a>p<span class="op">$</span>prediction_table</span></code></pre></div>
<pre><code>##      series                Level                Slope             Seasonal X
## 1: ACF.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
## 2: NSW.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
## 3:  NT.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
## 4:   Q.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
## 5:  SA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
## 6:   T.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
## 7:   V.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
## 8:  WA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;  
##               Predicted
## 1: &lt;tsmodel.predict[2]&gt;
## 2: &lt;tsmodel.predict[2]&gt;
## 3: &lt;tsmodel.predict[2]&gt;
## 4: &lt;tsmodel.predict[2]&gt;
## 5: &lt;tsmodel.predict[2]&gt;
## 6: &lt;tsmodel.predict[2]&gt;
## 7: &lt;tsmodel.predict[2]&gt;
## 8: &lt;tsmodel.predict[2]&gt;</code></pre>
<p>The plot method on the predicted object can output 1 series at a time using the <strong>series</strong> argument:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="tsvets.html#cb147-1"></a><span class="kw">plot</span>(p, <span class="dt">series =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-16-1.png" width="768" /></p>
<p>The simulation method also returns a list with a data.table object with each series’ simulation object and state decomposition. Additionally, there are optional arguments for the initial state to use (<strong>init_states</strong>) and parameter vector (<strong>pars</strong>).</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb148-1"><a href="tsvets.html#cb148-1"></a>s &lt;-<span class="st"> </span><span class="kw">simulate</span>(mod, <span class="dt">h =</span> <span class="dv">12</span><span class="op">*</span><span class="dv">8</span>, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">init_states =</span> mod<span class="op">$</span>spec<span class="op">$</span>vets_env<span class="op">$</span>States[,<span class="dv">1</span>])</span>
<span id="cb148-2"><a href="tsvets.html#cb148-2"></a>s<span class="op">$</span>simulation_table</span></code></pre></div>
<pre><code>##      series                Level                Slope             Seasonal
## 1: ACF.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 2: NSW.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 3:  NT.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 4:   Q.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 5:  SA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 6:   T.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 7:   V.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
## 8:  WA.NEWS &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt; &lt;tsmodel.predict[2]&gt;
##               Simulated
## 1: &lt;tsmodel.predict[2]&gt;
## 2: &lt;tsmodel.predict[2]&gt;
## 3: &lt;tsmodel.predict[2]&gt;
## 4: &lt;tsmodel.predict[2]&gt;
## 5: &lt;tsmodel.predict[2]&gt;
## 6: &lt;tsmodel.predict[2]&gt;
## 7: &lt;tsmodel.predict[2]&gt;
## 8: &lt;tsmodel.predict[2]&gt;</code></pre>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="tsvets.html#cb150-1"></a><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">4</span>,<span class="dv">1</span>),<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">3</span>))</span>
<span id="cb150-2"><a href="tsvets.html#cb150-2"></a><span class="kw">plot</span>(s<span class="op">$</span>simulation_table[series <span class="op">==</span><span class="st"> &quot;ACF.NEWS&quot;</span>]<span class="op">$</span>Simulated[[<span class="dv">1</span>]], <span class="dt">main =</span> <span class="st">&quot;Simulated Series&quot;</span>)</span>
<span id="cb150-3"><a href="tsvets.html#cb150-3"></a><span class="kw">plot</span>(s<span class="op">$</span>simulation_table[series <span class="op">==</span><span class="st"> &quot;ACF.NEWS&quot;</span>]<span class="op">$</span>Level[[<span class="dv">1</span>]], <span class="dt">main =</span> <span class="st">&quot;Simulated Level&quot;</span>)</span>
<span id="cb150-4"><a href="tsvets.html#cb150-4"></a><span class="kw">plot</span>(s<span class="op">$</span>simulation_table[series <span class="op">==</span><span class="st"> &quot;ACF.NEWS&quot;</span>]<span class="op">$</span>Slope[[<span class="dv">1</span>]], <span class="dt">main =</span> <span class="st">&quot;Simulated Slope&quot;</span>)</span>
<span id="cb150-5"><a href="tsvets.html#cb150-5"></a><span class="kw">plot</span>(s<span class="op">$</span>simulation_table[series <span class="op">==</span><span class="st"> &quot;ACF.NEWS&quot;</span>]<span class="op">$</span>Seasonal[[<span class="dv">1</span>]], <span class="dt">main =</span> <span class="st">&quot;Simulated Seasonal&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-17-1.png" width="768" /></p>
<p>The backtest method has similar arguments to other backtest implementations in the <strong>tsmodels</strong> framework:</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb151-1"><a href="tsvets.html#cb151-1"></a>b &lt;-<span class="st"> </span><span class="kw">tsbacktest</span>(spec, <span class="dt">h =</span> <span class="dv">12</span>, <span class="dt">cores =</span> <span class="dv">5</span>, <span class="dt">solver =</span> <span class="st">&quot;solnp&quot;</span>, <span class="dt">trace =</span> <span class="dv">0</span>)</span></code></pre></div>
<p>The returned object is a list of 2 data.tables with the predictions for each series by estimation date and horizon and the summary metrics table:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb152-1"><a href="tsvets.html#cb152-1"></a><span class="kw">head</span>(b<span class="op">$</span>prediction)</span></code></pre></div>
<pre><code>##      series estimation_date horizon size forecast_dates forecast actual
## 1: ACF.NEWS      2003-07-31       1  184     2003-08-31 11.20479   11.2
## 2: ACF.NEWS      2003-07-31       2  184     2003-09-30 10.62924   10.1
## 3: ACF.NEWS      2003-07-31       3  184     2003-10-31 10.47927    9.7
## 4: ACF.NEWS      2003-07-31       4  184     2003-11-30 11.18659    9.7
## 5: ACF.NEWS      2003-07-31       5  184     2003-12-31 15.52415   14.2
## 6: ACF.NEWS      2003-07-31       6  184     2004-01-31 10.14102    8.6</code></pre>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="tsvets.html#cb154-1"></a><span class="kw">head</span>(b<span class="op">$</span>metrics)</span></code></pre></div>
<pre><code>##      series horizon       MAPE      MSLRE       BIAS   n
## 1: ACF.NEWS       1 0.08389867 0.01158235 0.01611728 185
## 2: ACF.NEWS       2 0.09759896 0.01455978 0.02546004 184
## 3: ACF.NEWS       3 0.10813916 0.01749229 0.03402529 183
## 4: ACF.NEWS       4 0.11897309 0.02087350 0.04308926 182
## 5: ACF.NEWS       5 0.11691033 0.02073517 0.05150358 181
## 6: ACF.NEWS       6 0.12568410 0.02281976 0.05909700 180</code></pre>
</div>
<div id="tsvets:demonstration:example2" class="section level3">
<h3><span class="header-section-number">7.7.3</span> Example: Australian Retail Sales Grouped Dynamics</h3>
<p>In this example, we show how grouping works on 99 series, where grouping is by sector.</p>
<div class="sourceCode" id="cb156"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb156-1"><a href="tsvets.html#cb156-1"></a><span class="kw">suppressWarnings</span>(<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(tsvets)))</span>
<span id="cb156-2"><a href="tsvets.html#cb156-2"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsmethods))</span>
<span id="cb156-3"><a href="tsvets.html#cb156-3"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsaux))</span>
<span id="cb156-4"><a href="tsvets.html#cb156-4"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(xts))</span>
<span id="cb156-5"><a href="tsvets.html#cb156-5"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(data.table))</span>
<span id="cb156-6"><a href="tsvets.html#cb156-6"></a><span class="kw">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb156-7"><a href="tsvets.html#cb156-7"></a>y &lt;-<span class="st"> </span>austretail[<span class="st">&quot;2000/&quot;</span>]</span>
<span id="cb156-8"><a href="tsvets.html#cb156-8"></a>include &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(y), <span class="cf">function</span>(i) <span class="kw">all</span>(<span class="op">!</span><span class="kw">is.na</span>(y[,i])))</span>
<span id="cb156-9"><a href="tsvets.html#cb156-9"></a>y &lt;-<span class="st"> </span>y[,include]</span>
<span id="cb156-10"><a href="tsvets.html#cb156-10"></a>groups &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">ncol</span>(y), <span class="cf">function</span>(i) <span class="kw">strsplit</span>(<span class="kw">colnames</span>(y[,i]), <span class="st">&quot;</span><span class="ch">\\</span><span class="st">.&quot;</span>)[[<span class="dv">1</span>]][<span class="dv">2</span>])</span>
<span id="cb156-11"><a href="tsvets.html#cb156-11"></a>groups_index &lt;-<span class="st"> </span><span class="kw">sort.int</span>(groups, <span class="dt">index.return =</span> <span class="ot">TRUE</span>)</span>
<span id="cb156-12"><a href="tsvets.html#cb156-12"></a>y &lt;-<span class="st"> </span>y[,groups_index<span class="op">$</span>ix]</span>
<span id="cb156-13"><a href="tsvets.html#cb156-13"></a>groups &lt;-<span class="st"> </span>groups[groups_index<span class="op">$</span>ix]</span>
<span id="cb156-14"><a href="tsvets.html#cb156-14"></a>groups &lt;-<span class="st"> </span><span class="kw">rle</span>(groups)<span class="op">$</span>lengths</span>
<span id="cb156-15"><a href="tsvets.html#cb156-15"></a>groups &lt;-<span class="st"> </span><span class="kw">unlist</span>(<span class="kw">sapply</span>(<span class="dv">1</span><span class="op">:</span><span class="kw">length</span>(groups), <span class="cf">function</span>(i) <span class="kw">rep</span>(i, groups[i])))</span>
<span id="cb156-16"><a href="tsvets.html#cb156-16"></a>spec &lt;-<span class="st"> </span><span class="kw">vets_modelspec</span>(y[,<span class="dv">1</span><span class="op">:</span><span class="dv">99</span>], <span class="dt">level =</span> <span class="st">&quot;grouped&quot;</span>, <span class="dt">slope =</span> <span class="st">&quot;grouped&quot;</span>, <span class="dt">damped =</span> <span class="st">&quot;none&quot;</span>, <span class="dt">group =</span> groups[<span class="dv">1</span><span class="op">:</span><span class="dv">99</span>],</span>
<span id="cb156-17"><a href="tsvets.html#cb156-17"></a>                       <span class="dt">seasonal =</span> <span class="st">&quot;grouped&quot;</span>, <span class="dt">lambda =</span> <span class="fl">0.5</span>, <span class="dt">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="dt">frequency =</span> <span class="dv">12</span>, <span class="dt">cores =</span> <span class="dv">3</span>)</span>
<span id="cb156-18"><a href="tsvets.html#cb156-18"></a>mod &lt;-<span class="st"> </span><span class="kw">estimate</span>(spec, <span class="dt">solver =</span> <span class="st">&quot;solnp&quot;</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>The joint estimation of the 99 series takes about 3.0726999 minutes.</p>
<p>We avoid the summary method for such a large object, and instead print out the coefficients and the performance metrics:</p>
<div class="sourceCode" id="cb157"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb157-1"><a href="tsvets.html#cb157-1"></a>cf &lt;-<span class="st"> </span><span class="kw">coef</span>(mod)</span>
<span id="cb157-2"><a href="tsvets.html#cb157-2"></a><span class="kw">print</span>(data.table<span class="op">::</span><span class="kw">data.table</span>(<span class="dt">Coefficient =</span> <span class="kw">names</span>(cf), <span class="dt">Value =</span> <span class="kw">round</span>(cf,<span class="dv">4</span>)))</span></code></pre></div>
<pre><code>##              Coefficient  Value
##  1:     Level[Group = 1] 0.4481
##  2:     Level[Group = 2] 0.5108
##  3:     Level[Group = 3] 0.7151
##  4:     Level[Group = 4] 0.6882
##  5:     Level[Group = 5] 0.1667
##  6:     Level[Group = 6] 0.5208
##  7:     Level[Group = 7] 0.5494
##  8:     Level[Group = 8] 0.4183
##  9:     Level[Group = 9] 0.5011
## 10:    Level[Group = 10] 0.5867
## 11:    Level[Group = 11] 0.6780
## 12:    Level[Group = 12] 0.4934
## 13:    Level[Group = 13] 0.7206
## 14:     Slope[Group = 1] 0.0000
## 15:     Slope[Group = 2] 0.0000
## 16:     Slope[Group = 3] 0.0000
## 17:     Slope[Group = 4] 0.0000
## 18:     Slope[Group = 5] 0.0073
## 19:     Slope[Group = 6] 0.0000
## 20:     Slope[Group = 7] 0.0000
## 21:     Slope[Group = 8] 0.0000
## 22:     Slope[Group = 9] 0.0000
## 23:    Slope[Group = 10] 0.0056
## 24:    Slope[Group = 11] 0.0000
## 25:    Slope[Group = 12] 0.0000
## 26:    Slope[Group = 13] 0.0000
## 27:  Seasonal[Group = 1] 0.3418
## 28:  Seasonal[Group = 2] 0.1879
## 29:  Seasonal[Group = 3] 0.0000
## 30:  Seasonal[Group = 4] 0.0000
## 31:  Seasonal[Group = 5] 0.1334
## 32:  Seasonal[Group = 6] 0.2645
## 33:  Seasonal[Group = 7] 0.0000
## 34:  Seasonal[Group = 8] 0.3150
## 35:  Seasonal[Group = 9] 0.3885
## 36: Seasonal[Group = 10] 0.0245
## 37: Seasonal[Group = 11] 0.0986
## 38: Seasonal[Group = 12] 0.2692
## 39: Seasonal[Group = 13] 0.0000
##              Coefficient  Value</code></pre>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="tsvets.html#cb159-1"></a><span class="kw">tsmetrics</span>(mod)</span></code></pre></div>
<pre><code>##       N no_pars    LogLik       AIC      BIC      AICc       MAPE       MSLRE
## 1 22572    1425 -7608.464 -4758.464 6676.399 -4566.272 0.04053744 0.003140805
##         WAPE       WSLRE
## 1 0.04053744 0.003140805</code></pre>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="tsvets.html#cb161-1"></a><span class="kw">plot</span>(mod, <span class="dt">series =</span> (<span class="dv">1</span><span class="op">:</span><span class="dv">99</span>)[groups <span class="op">==</span><span class="st"> </span><span class="dv">4</span>])</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-23-1.png" width="768" /></p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="tsvets.html#cb162-1"></a><span class="kw">plot</span>(mod, <span class="dt">series =</span> (<span class="dv">1</span><span class="op">:</span><span class="dv">99</span>)[groups <span class="op">==</span><span class="st"> </span><span class="dv">4</span>], <span class="dt">type =</span> <span class="st">&quot;states&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-23-2.png" width="768" /></p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="tsvets.html#cb163-1"></a><span class="kw">plot</span>(mod, <span class="dt">series =</span> (<span class="dv">1</span><span class="op">:</span><span class="dv">99</span>)[groups <span class="op">==</span><span class="st"> </span><span class="dv">4</span>], <span class="dt">type =</span> <span class="st">&quot;residuals&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-23-3.png" width="768" /></p>
</div>
<div id="tsvets:demonstration:example3" class="section level3">
<h3><span class="header-section-number">7.7.4</span> Example: Australian Retail Sales Filtering</h3>
<p>This example highlights the use of the <em>tsfilter</em> method for online filtering as already discussed in Sections <a href="tsets.html#tsets:demonstration:filtering">5.6.4</a> and <a href="tsissm.html#tsissm:demonstration:filtering">6.5.5</a>.</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb164-1"><a href="tsvets.html#cb164-1"></a><span class="kw">suppressWarnings</span>(<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(tsvets)))</span>
<span id="cb164-2"><a href="tsvets.html#cb164-2"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsmethods))</span>
<span id="cb164-3"><a href="tsvets.html#cb164-3"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsaux))</span>
<span id="cb164-4"><a href="tsvets.html#cb164-4"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(xts))</span>
<span id="cb164-5"><a href="tsvets.html#cb164-5"></a><span class="kw">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb164-6"><a href="tsvets.html#cb164-6"></a>y &lt;-<span class="st"> </span><span class="kw">na.omit</span>(austretail[,<span class="kw">grepl</span>(<span class="st">&quot;NEWS&quot;</span>, <span class="kw">colnames</span>(austretail))])</span>
<span id="cb164-7"><a href="tsvets.html#cb164-7"></a>y_train &lt;-<span class="st"> </span>y[<span class="dv">1</span><span class="op">:</span>(<span class="dv">369</span> <span class="op">-</span><span class="st"> </span><span class="dv">24</span>)]</span>
<span id="cb164-8"><a href="tsvets.html#cb164-8"></a>y_test &lt;-<span class="st"> </span>y[(<span class="dv">369</span> <span class="op">-</span><span class="st"> </span><span class="dv">24</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>)<span class="op">:</span><span class="dv">369</span>]</span>
<span id="cb164-9"><a href="tsvets.html#cb164-9"></a>spec &lt;-<span class="st"> </span><span class="kw">vets_modelspec</span>(y_train, <span class="dt">level =</span> <span class="st">&quot;common&quot;</span>, <span class="dt">slope =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="dt">damped =</span> <span class="st">&quot;none&quot;</span>, </span>
<span id="cb164-10"><a href="tsvets.html#cb164-10"></a>                       <span class="dt">seasonal =</span> <span class="st">&quot;common&quot;</span>, <span class="dt">lambda =</span> <span class="fl">0.5</span>, <span class="dt">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="dt">frequency =</span> <span class="dv">12</span>, <span class="dt">cores =</span> <span class="dv">3</span>)</span>
<span id="cb164-11"><a href="tsvets.html#cb164-11"></a>mod &lt;-<span class="st"> </span><span class="kw">estimate</span>(spec, <span class="dt">solver =</span> <span class="st">&quot;solnp&quot;</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace=</span><span class="dv">0</span>))</span>
<span id="cb164-12"><a href="tsvets.html#cb164-12"></a>filt &lt;-<span class="st"> </span><span class="kw">tsfilter</span>(mod, <span class="dt">y =</span> y_test)</span>
<span id="cb164-13"><a href="tsvets.html#cb164-13"></a><span class="kw">tail</span>(<span class="kw">fitted</span>(mod))</span></code></pre></div>
<pre><code>##            ACF.NEWS  NSW.NEWS  NT.NEWS   Q.NEWS   SA.NEWS   T.NEWS   V.NEWS
## 2016-07-31 6.274797  85.48924 1.563078 51.79401 12.263422 12.41307 47.63890
## 2016-08-31 5.822142  87.91922 1.518186 54.59903 10.952638 12.97214 47.66847
## 2016-09-30 4.902063  81.27384 1.394670 51.86893  9.940540 13.71905 45.84747
## 2016-10-31 4.791340  83.27199 1.319689 55.07795  9.960862 12.42058 49.48284
## 2016-11-30 5.547109  86.93623 1.357322 54.95787 10.368370 12.07245 50.89751
## 2016-12-31 8.184713 116.27847 1.858932 72.01650 15.622348 14.69097 76.20897
##             WA.NEWS
## 2016-07-31 40.75593
## 2016-08-31 42.52748
## 2016-09-30 39.24564
## 2016-10-31 40.45787
## 2016-11-30 41.79132
## 2016-12-31 55.58460</code></pre>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="tsvets.html#cb166-1"></a><span class="kw">head</span>(<span class="kw">tail</span>(<span class="kw">fitted</span>(filt), <span class="dv">24</span> <span class="op">+</span><span class="st"> </span><span class="dv">1</span>), <span class="dv">5</span>)</span></code></pre></div>
<pre><code>##            ACF.NEWS  NSW.NEWS  NT.NEWS   Q.NEWS   SA.NEWS   T.NEWS   V.NEWS
## 2016-12-31 8.184713 116.27847 1.858932 72.01650 15.622348 14.69097 76.20897
## 2017-01-31 5.136207  92.07693 1.239746 57.96096  8.790413 12.48529 47.68477
## 2017-02-28 7.150196  94.62239 1.098937 52.06103  9.564020 13.50577 47.71323
## 2017-03-31 5.671763  98.44472 1.105182 54.21635 11.124741 11.63927 52.55806
## 2017-04-30 4.718633  82.17763 1.158383 51.48423  8.319094 10.94583 47.45608
##             WA.NEWS
## 2016-12-31 55.58460
## 2017-01-31 48.38625
## 2017-02-28 40.52984
## 2017-03-31 40.46547
## 2017-04-30 37.86586</code></pre>
</div>
<div id="tsvets:demonstration:example4" class="section level3">
<h3><span class="header-section-number">7.7.5</span> Example: Australian Retail Sales Aggregation</h3>
<p>This demonstrates the ability to aggregate a model estimated with homogeneous coefficients. We continue with the retail sales data, which being a set of flow variables, can be aggregated.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="tsvets.html#cb168-1"></a><span class="kw">suppressWarnings</span>(<span class="kw">suppressPackageStartupMessages</span>(<span class="kw">library</span>(tsvets)))</span>
<span id="cb168-2"><a href="tsvets.html#cb168-2"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsmethods))</span>
<span id="cb168-3"><a href="tsvets.html#cb168-3"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(tsaux))</span>
<span id="cb168-4"><a href="tsvets.html#cb168-4"></a><span class="kw">suppressMessages</span>(<span class="kw">library</span>(xts))</span>
<span id="cb168-5"><a href="tsvets.html#cb168-5"></a><span class="kw">data</span>(<span class="st">&quot;austretail&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb168-6"><a href="tsvets.html#cb168-6"></a>y &lt;-<span class="st"> </span><span class="kw">na.omit</span>(austretail[,<span class="kw">grepl</span>(<span class="st">&quot;NEWS&quot;</span>, <span class="kw">colnames</span>(austretail))])</span></code></pre></div>
<p>We use a vector of ones as weights, to denote summation to the total for the News category.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="tsvets.html#cb169-1"></a>weights &lt;-<span class="st"> </span><span class="kw">rep</span>(<span class="dv">1</span>, <span class="dv">8</span>)</span></code></pre></div>
<p>Additionally, we also include, purely for expositional purposes, a matrix of 5 randomly generated regressors:</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="tsvets.html#cb170-1"></a>xreg &lt;-<span class="st"> </span><span class="kw">xts</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="kw">nrow</span>(y) <span class="op">*</span><span class="st"> </span><span class="dv">5</span>), <span class="dt">nrow =</span> <span class="kw">nrow</span>(y), <span class="dt">ncol =</span> <span class="dv">5</span>), <span class="kw">index</span>(y))</span>
<span id="cb170-2"><a href="tsvets.html#cb170-2"></a>xreg_include &lt;-<span class="st"> </span><span class="kw">matrix</span>(<span class="dv">2</span>, <span class="dt">ncol =</span> <span class="dv">5</span>, <span class="dt">nrow =</span> <span class="kw">ncol</span>(y))</span>
<span id="cb170-3"><a href="tsvets.html#cb170-3"></a>xreg_include[<span class="dv">2</span>,<span class="dv">1</span>] &lt;-<span class="st"> </span><span class="dv">1</span></span></code></pre></div>
<p>Setting the include matrix to the value of 2 means pooling, and we also set regressor 1 for series 2 to a value of 1 in order to denote that we want this to be estimated seperately (non-pooled).</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="tsvets.html#cb171-1"></a>spec &lt;-<span class="st"> </span><span class="kw">vets_modelspec</span>(y, <span class="dt">level =</span> <span class="st">&quot;common&quot;</span>,  <span class="dt">slope =</span> <span class="st">&quot;common&quot;</span>, <span class="dt">seasonal =</span> <span class="st">&quot;common&quot;</span>, <span class="dt">dependence =</span> <span class="st">&quot;diagonal&quot;</span>, <span class="dt">frequency =</span> <span class="dv">12</span>, <span class="dt">cores =</span> <span class="dv">2</span>, <span class="dt">xreg =</span> xreg, <span class="dt">xreg_include =</span> xreg_include)</span>
<span id="cb171-2"><a href="tsvets.html#cb171-2"></a>mod &lt;-<span class="st"> </span><span class="kw">estimate</span>(spec, <span class="dt">solver =</span> <span class="st">&quot;solnp&quot;</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace =</span> <span class="dv">0</span>))</span></code></pre></div>
<p>We can extract specific matrices from the estimate object using the as yet unexported function <strong>p_matrix</strong>:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb172-1"><a href="tsvets.html#cb172-1"></a>tsvets<span class="op">:::</span><span class="kw">p_matrix</span>(mod)<span class="op">$</span>X</span></code></pre></div>
<pre><code>## 8 x 5 Matrix of class &quot;dgeMatrix&quot;
##                     x1         x2           x3           x4        x5
## ACF.NEWS -0.0007804236 0.02138595 -0.004022953 -0.004194527 0.0246474
## NSW.NEWS  0.0769983870 0.02138595 -0.004022953 -0.004194527 0.0246474
## NT.NEWS  -0.0007804236 0.02138595 -0.004022953 -0.004194527 0.0246474
## Q.NEWS   -0.0007804236 0.02138595 -0.004022953 -0.004194527 0.0246474
## SA.NEWS  -0.0007804236 0.02138595 -0.004022953 -0.004194527 0.0246474
## T.NEWS   -0.0007804236 0.02138595 -0.004022953 -0.004194527 0.0246474
## V.NEWS   -0.0007804236 0.02138595 -0.004022953 -0.004194527 0.0246474
## WA.NEWS  -0.0007804236 0.02138595 -0.004022953 -0.004194527 0.0246474</code></pre>
<p>where we can observe that the coefficients for each regressor have been pooled, with the exception of x1 for the NSW.NEWS series.</p>
<p>We can now proceed to aggregate the model using the <em>tsaggregate</em> method on the estimated object:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="tsvets.html#cb174-1"></a>mod_aggregate &lt;-<span class="st"> </span><span class="kw">tsaggregate</span>(mod, <span class="dt">weights =</span> weights, <span class="dt">return_model =</span> <span class="ot">TRUE</span>)</span>
<span id="cb174-2"><a href="tsvets.html#cb174-2"></a><span class="kw">summary</span>(mod_aggregate)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : common 
## Seasonal : common 
## Dependence : diagonal 
## No. Series : 1 
## No. TimePoints : 369 
## 
## Parameter Matrices
## 
## Level Matrix
## 1 x 1 Matrix of class &quot;dsyMatrix&quot;
##           [,1]
## [1,] 0.6221235
## 
## Slope Matrix
## 1 x 1 Matrix of class &quot;dsyMatrix&quot;
##              [,1]
## [1,] 2.786582e-09
## 
## Seasonal Matrix
## 1 x 1 Matrix of class &quot;dsyMatrix&quot;
##           [,1]
## [1,] 0.1276449
## 
## Regressor Matrix
## 1 x 5 Matrix of class &quot;dgeMatrix&quot;
##                   x1        x2          x3          x4        x5
## aggregate 0.07153542 0.1710876 -0.03218363 -0.03355621 0.1971792
## 
## Covariance Matrix
## 1 x 1 Matrix of class &quot;dsyMatrix&quot;
##           aggregate
## aggregate  222.8112
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0353   0.0353
## MSLRE 0.0021   0.0021</code></pre>
<div class="sourceCode" id="cb176"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb176-1"><a href="tsvets.html#cb176-1"></a><span class="kw">plot</span>(mod_aggregate)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-29-1.png" width="768" /></p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb177-1"><a href="tsvets.html#cb177-1"></a><span class="kw">suppressWarnings</span>(<span class="kw">plot</span>(mod_aggregate, <span class="dt">type =</span> <span class="st">&quot;states&quot;</span>))</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-29-2.png" width="768" /></p>
<p>We can then proceed with prediction as well as simulation, both of which allow for the outputs to be aggregated. Alternatively, since we now have an aggregated model object, we can also predict or simulate directly from that object.</p>
<div class="sourceCode" id="cb178"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb178-1"><a href="tsvets.html#cb178-1"></a>newxreg &lt;-<span class="st"> </span><span class="kw">xts</span>(<span class="kw">matrix</span>(<span class="kw">rnorm</span>(<span class="dv">24</span> <span class="op">*</span><span class="st"> </span><span class="dv">5</span>), <span class="dt">nrow =</span> <span class="dv">24</span>, <span class="dt">ncol =</span> <span class="dv">5</span>), <span class="kw">future_dates</span>(<span class="kw">tail</span>(<span class="kw">index</span>(y),<span class="dv">1</span>),<span class="st">&quot;months&quot;</span>,<span class="dv">24</span>))</span>
<span id="cb178-2"><a href="tsvets.html#cb178-2"></a>p &lt;-<span class="st"> </span><span class="kw">predict</span>(mod, <span class="dt">newxreg =</span> newxreg)</span>
<span id="cb178-3"><a href="tsvets.html#cb178-3"></a>p_agg_series &lt;-<span class="st"> </span><span class="kw">tsaggregate</span>(p, <span class="dt">weights =</span> weights)</span>
<span id="cb178-4"><a href="tsvets.html#cb178-4"></a>p_agg_model &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_aggregate, <span class="dt">newxreg =</span> newxreg)</span>
<span id="cb178-5"><a href="tsvets.html#cb178-5"></a><span class="kw">plot</span>(p_agg_series<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey&quot;</span>, <span class="dt">main =</span> <span class="st">&quot;Agggregated Model&quot;</span>)</span>
<span id="cb178-6"><a href="tsvets.html#cb178-6"></a><span class="kw">plot</span>(p_agg_model<span class="op">$</span>prediction_table[<span class="dv">1</span>]<span class="op">$</span>Predicted[[<span class="dv">1</span>]]<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">median_color =</span> <span class="dv">2</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey10&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-30-1.png" width="672" /></p>
<p>As we can observe, the output of the 2 predictions is identical (subject to some randomness from the simulation of the predictive distribution). We do the same for the simulation method:</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb179-1"><a href="tsvets.html#cb179-1"></a>s &lt;-<span class="st"> </span><span class="kw">simulate</span>(mod, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">h =</span> <span class="dv">24</span>, <span class="dt">newxreg =</span> newxreg, <span class="dt">seed =</span> <span class="dv">700</span>)</span>
<span id="cb179-2"><a href="tsvets.html#cb179-2"></a>s_agg_series &lt;-<span class="st"> </span><span class="kw">tsaggregate</span>(s, <span class="dt">weights =</span> weights)</span>
<span id="cb179-3"><a href="tsvets.html#cb179-3"></a>s_agg_model &lt;-<span class="st"> </span><span class="kw">simulate</span>(mod_aggregate, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">h =</span> <span class="dv">24</span>, <span class="dt">newxreg =</span> newxreg, <span class="dt">seed =</span> <span class="dv">700</span>)</span>
<span id="cb179-4"><a href="tsvets.html#cb179-4"></a><span class="kw">plot</span>(s_agg_series<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb179-5"><a href="tsvets.html#cb179-5"></a><span class="kw">plot</span>(s_agg_model<span class="op">$</span>simulation_table[<span class="dv">1</span>]<span class="op">$</span>Simulated[[<span class="dv">1</span>]]<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">median_color =</span> <span class="dv">2</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey10&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-31-1.png" width="672" /></p>
<p>which is again almost identical, but we can achieve exact replication is we use the bootstrap residuals method:</p>
<div class="sourceCode" id="cb180"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb180-1"><a href="tsvets.html#cb180-1"></a>s &lt;-<span class="st"> </span><span class="kw">simulate</span>(mod, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">h =</span> <span class="dv">24</span>, <span class="dt">newxreg =</span> newxreg, <span class="dt">seed =</span> <span class="dv">700</span>, <span class="dt">bootstrap =</span> <span class="ot">TRUE</span>)</span>
<span id="cb180-2"><a href="tsvets.html#cb180-2"></a>s_agg_series &lt;-<span class="st"> </span><span class="kw">tsaggregate</span>(s, <span class="dt">weights =</span> weights)</span>
<span id="cb180-3"><a href="tsvets.html#cb180-3"></a>s_agg_model &lt;-<span class="st"> </span><span class="kw">simulate</span>(mod_aggregate, <span class="dt">nsim =</span> <span class="dv">100</span>, <span class="dt">h =</span> <span class="dv">24</span>, <span class="dt">newxreg =</span> newxreg, <span class="dt">seed =</span> <span class="dv">700</span>, <span class="dt">bootstrap =</span> <span class="ot">TRUE</span>)</span>
<span id="cb180-4"><a href="tsvets.html#cb180-4"></a></span>
<span id="cb180-5"><a href="tsvets.html#cb180-5"></a><span class="kw">plot</span>(s_agg_series<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb180-6"><a href="tsvets.html#cb180-6"></a><span class="kw">plot</span>(s_agg_model<span class="op">$</span>simulation_table[<span class="dv">1</span>]<span class="op">$</span>Simulated[[<span class="dv">1</span>]]<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">median_color =</span> <span class="dv">2</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey10&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-32-1.png" width="672" /></p>
</div>
<div id="tsvets:demonstration:example5" class="section level3">
<h3><span class="header-section-number">7.7.6</span> Example: Price Volume Aggregation</h3>
<p>This final example shows how to jointly model a series based on price-volume relationship with a target of generating a model for Sales:
<span class="math inline">\(Sales = Price\times Volume\)</span></p>
<p>While this is a multiplicative model, if we were to model the series using a log transformation we would be able to aggregate the model in logs before exponentiating to recover the Sales as the example will demonstrate.</p>
<div class="sourceCode" id="cb181"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb181-1"><a href="tsvets.html#cb181-1"></a><span class="kw">data</span>(<span class="st">&quot;priceunits&quot;</span>, <span class="dt">package =</span> <span class="st">&quot;tsdatasets&quot;</span>)</span>
<span id="cb181-2"><a href="tsvets.html#cb181-2"></a>spec &lt;-<span class="st"> </span><span class="kw">vets_modelspec</span>(priceunits, <span class="dt">level =</span> <span class="st">&quot;common&quot;</span>, <span class="dt">slope =</span> <span class="st">&quot;common&quot;</span>, <span class="dt">frequency =</span> <span class="dv">12</span>, <span class="dt">lambda =</span> <span class="kw">rep</span>(<span class="dv">0</span>,<span class="dv">2</span>), <span class="dt">dependence =</span> <span class="st">&quot;full&quot;</span>)</span>
<span id="cb181-3"><a href="tsvets.html#cb181-3"></a>mod &lt;-<span class="st"> </span><span class="kw">estimate</span>(spec, <span class="dt">solver =</span> <span class="st">&quot;optim&quot;</span>, <span class="dt">control =</span> <span class="kw">list</span>(<span class="dt">trace =</span> <span class="dv">0</span>))</span>
<span id="cb181-4"><a href="tsvets.html#cb181-4"></a><span class="kw">summary</span>(mod)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : common 
## Seasonal : none 
## Dependence : full 
## No. Series : 2 
## No. TimePoints : 100 
## 
## Parameter Matrices
## 
## Level Matrix
## 2 x 2 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]      [,2]     
## [1,] 0.4012599         .
## [2,]         . 0.4012599
## 
## Slope Matrix
## 2 x 2 diagonal matrix of class &quot;ddiMatrix&quot;
##      [,1]       [,2]      
## [1,] 0.07645748          .
## [2,]          . 0.07645748
## 
## Correlation Matrix
## 2 x 2 Matrix of class &quot;dsyMatrix&quot;
##            price      units
## price  1.0000000 -0.6009332
## units -0.6009332  1.0000000
## 
## Information Criteria
##  AIC    BIC    AICc 
##  162.76 182.55 163.2
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0508   0.0508
## MSLRE 0.0042   0.0042</code></pre>
<div class="sourceCode" id="cb183"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb183-1"><a href="tsvets.html#cb183-1"></a><span class="kw">plot</span>(mod)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-34-1.png" width="768" /></p>
<div class="sourceCode" id="cb184"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb184-1"><a href="tsvets.html#cb184-1"></a><span class="kw">plot</span>(mod, <span class="dt">type =</span> <span class="st">&quot;states&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-34-2.png" width="768" /></p>
<div class="sourceCode" id="cb185"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb185-1"><a href="tsvets.html#cb185-1"></a>weights &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">1</span>)</span>
<span id="cb185-2"><a href="tsvets.html#cb185-2"></a>mod_aggregate &lt;-<span class="st"> </span><span class="kw">tsaggregate</span>(mod, <span class="dt">weights =</span> weights, <span class="dt">return_model =</span> <span class="ot">TRUE</span>)</span>
<span id="cb185-3"><a href="tsvets.html#cb185-3"></a><span class="kw">summary</span>(mod_aggregate)</span></code></pre></div>
<pre><code>## 
##            Vector ETS            
## -----------------------------------
## Level : common 
## Slope : common 
## Seasonal : none 
## Dependence : diagonal 
## No. Series : 1 
## No. TimePoints : 100 
## 
## Parameter Matrices
## 
## Level Matrix
## 1 x 1 Matrix of class &quot;dsyMatrix&quot;
##           [,1]
## [1,] 0.4012599
## 
## Slope Matrix
## 1 x 1 Matrix of class &quot;dsyMatrix&quot;
##            [,1]
## [1,] 0.07645748
## 
## Covariance Matrix
## 1 x 1 Matrix of class &quot;dsyMatrix&quot;
##             aggregate
## aggregate 0.003891903
## 
## Accuracy Criteria
##         Mean Weighted
## MAPE  0.0496   0.0496
## MSLRE 0.0039   0.0039</code></pre>
<div class="sourceCode" id="cb187"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb187-1"><a href="tsvets.html#cb187-1"></a>p &lt;-<span class="st"> </span><span class="kw">predict</span>(mod,  <span class="dt">h =</span> <span class="dv">24</span>)</span>
<span id="cb187-2"><a href="tsvets.html#cb187-2"></a>p_agg_model &lt;-<span class="st"> </span><span class="kw">predict</span>(mod_aggregate, <span class="dt">h =</span> <span class="dv">24</span>)</span>
<span id="cb187-3"><a href="tsvets.html#cb187-3"></a>p_agg_series &lt;-<span class="st"> </span><span class="kw">tsaggregate</span>(p, <span class="dt">weights =</span> weights)</span>
<span id="cb187-4"><a href="tsvets.html#cb187-4"></a><span class="kw">plot</span>(p_agg_model<span class="op">$</span>prediction_table[<span class="dv">1</span>]<span class="op">$</span>Predicted[[<span class="dv">1</span>]]<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey&quot;</span>)</span>
<span id="cb187-5"><a href="tsvets.html#cb187-5"></a><span class="kw">plot</span>(p_agg_series<span class="op">$</span>distribution, <span class="dt">gradient_color =</span> <span class="st">&quot;whitesmoke&quot;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>, <span class="dt">median_color =</span> <span class="dv">2</span>, <span class="dt">interval_color =</span> <span class="st">&quot;grey10&quot;</span>)</span></code></pre></div>
<p><img src="tsmodels_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
<p>In the presence of a non-homogeneous model, or a homogeneous model with Box Cox parameter not equal to either 0 (log) or 1 (no transform), then the <em>tsaggregate</em> method will still work but the return_model arguments needs to be set to FALSE and the resulting output will just be the aggregated series.</p>

</div>
</div>
</div>
<h3>References</h3>
<div id="refs" class="references">
<div id="ref-athanasopoulos2012">
<p>Athanasopoulos, George, and Ashton de Silva. 2012. “Multivariate Exponential Smoothing for Forecasting Tourist Arrivals.” <em>Journal of Travel Research</em> 51 (5): 640–52.</p>
</div>
<div id="ref-R-Matrix">
<p>Bates, Douglas, and Martin Maechler. 2019. <em>Matrix: Sparse and Dense Matrix Classes and Methods</em>. <a href="https://CRAN.R-project.org/package=Matrix">https://CRAN.R-project.org/package=Matrix</a>.</p>
</div>
<div id="ref-clements2015benefits">
<p>Clements, Adam, Ayesha Scott, and Annastiina Silvennoinen. 2015. “On the Benefits of Equicorrelation for Portfolio Allocation.” <em>Journal of Forecasting</em> 34 (6): 507–22.</p>
</div>
<div id="ref-desilva2010">
<p>De Silva, Ashton, Rob J Hyndman, and Ralph Snyder. 2010b. “The Vector Innovations Structural Time Series Framework: A Simple Approach to Multivariate Forecasting.” <em>Statistical Modelling</em> 10 (4): 353–74.</p>
</div>
<div id="ref-R-car">
<p>Fox, John, Sanford Weisberg, and Brad Price. 2020. <em>Car: Companion to Applied Regression</em>. <a href="https://CRAN.R-project.org/package=car">https://CRAN.R-project.org/package=car</a>.</p>
</div>
<div id="ref-hyndman2008">
<p>Hyndman, Rob, Anne B Koehler, J Keith Ord, and Ralph D Snyder. 2008. <em>Forecasting with Exponential Smoothing: The State Space Approach</em>. Springer Science &amp; Business Media.</p>
</div>
<div id="ref-R-MVN">
<p>Korkmaz, Selcuk, Dincer Goksuluk, and Gokmen Zararsiz. 2019. <em>MVN: Multivariate Normality Tests</em>. <a href="https://CRAN.R-project.org/package=MVN">https://CRAN.R-project.org/package=MVN</a>.</p>
</div>
<div id="ref-ledoit2004well">
<p>Ledoit, Olivier, and Michael Wolf. 2004. “A Well-Conditioned Estimator for Large-Dimensional Covariance Matrices.” <em>Journal of Multivariate Analysis</em> 88 (2): 365–411.</p>
</div>
<div id="ref-velilla1993note">
<p>Velilla, Santiago. 1993. “A Note on the Multivariate Box—Cox Transformation to Normality.” <em>Statistics &amp; Probability Letters</em> 17 (4): 259–63.</p>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="17">
<li id="fn17"><p>Using for instance the Eigen decomposition of the covariance matrix<a href="tsvets.html#fnref17" class="footnote-back">↩︎</a></p></li>
<li id="fn18"><p>Which will almost surely lead to invertibility problems if they are all sampled at their extremes, but we prefer to catch that case with the barrier constraint rather than enforcing difficult to implement row-wise constraints on each matrix.<a href="tsvets.html#fnref18" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tsissm.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="tsforeign.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
